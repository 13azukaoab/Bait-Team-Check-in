<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ 120KB</title>
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .upload-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        input[type="file"] {
            padding: 10px;
            margin: 10px 0;
        }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .image-box {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }
        .image-box h3 {
            background: #f8f9fa;
            padding: 12px;
            margin: 0;
            font-size: 14px;
            border-bottom: 1px solid #e9ecef;
        }
        .image-display {
            width: 100%;
            height: 300px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }
        .image-display img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .image-info {
            padding: 12px;
            background: #f8f9fa;
            font-size: 13px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        .message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            text-align: center;
        }
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        .message.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ 120KB</h1>

        <div class="upload-section">
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Demo</p>
            <input type="file" id="fileInput" accept="image/*" />
            <br/>
            <button onclick="selectFile()">üì§ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</button>
            <button onclick="createDemo()">üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á Demo</button>
            <button onclick="resetAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
            
            <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
            <p><strong>üìÅ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:</strong></p>
            <button onclick="loadLocalImage('IMG_2564.jpg')" style="background: #28a745;">IMG_2564</button>
            <button onclick="loadLocalImage('IMG_2565.jpg')" style="background: #28a745;">IMG_2565</button>
            <button onclick="loadLocalImage('IMG_2567.jpg')" style="background: #28a745;">IMG_2567</button>
            <button onclick="loadLocalImage('IMG_2568.jpg')" style="background: #28a745;">IMG_2568</button>
        </div>

        <div id="messageArea"></div>

        <div class="comparison">
            <div class="image-box">
                <h3>Original (‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)</h3>
                <div class="image-display" id="originalDisplay">
                    <p style="color: #999;">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...</p>
                </div>
                <div class="image-info">
                    <div class="info-row">
                        <span>‡∏Ç‡∏ô‡∏≤‡∏î:</span>
                        <strong id="origSize">-</strong>
                    </div>
                    <div class="info-row">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á:</span>
                        <strong id="origWidth">-</strong>
                    </div>
                    <div class="info-row">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á:</span>
                        <strong id="origHeight">-</strong>
                    </div>
                </div>
            </div>

            <div class="image-box">
                <h3>Compressed 120KB (‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î)</h3>
                <div class="image-display" id="compressedDisplay">
                    <p style="color: #999;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î...</p>
                </div>
                <div class="image-info">
                    <div class="info-row">
                        <span>‡∏Ç‡∏ô‡∏≤‡∏î:</span>
                        <strong id="compSize">-</strong>
                    </div>
                    <div class="info-row">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á:</span>
                        <strong id="compWidth">-</strong>
                    </div>
                    <div class="info-row">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á:</span>
                        <strong id="compHeight">-</strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="ratio">-</div>
                <div class="stat-label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="diff">-</div>
                <div class="stat-label">‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="uploadTime">-</div>
                <div class="stat-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="monthlyUsage">-</div>
                <div class="stat-label">‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            </div>
        </div>
    </div>

    <script>
        let originalImage = null;
        let originalSize = 0;

        function selectFile() {
            document.getElementById('fileInput').click();
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
        function loadLocalImage(filename) {
            showMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î: ${filename}`, 'info');
            
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP error ' + response.status);
                    }
                    return response.arrayBuffer();
                })
                .then(arrayBuffer => {
                    console.log('Fetched arrayBuffer:', arrayBuffer.byteLength, 'bytes');
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö magic bytes ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ type ‡∏à‡∏£‡∏¥‡∏á
                    const arr = new Uint8Array(arrayBuffer.slice(0, 12));
                    let mimeType = 'image/jpeg';
                    
                    // Check JPEG: FF D8 FF
                    if (arr[0] === 0xFF && arr[1] === 0xD8 && arr[2] === 0xFF) {
                        mimeType = 'image/jpeg';
                        console.log('Detected: JPEG');
                    }
                    // Check PNG: 89 50 4E 47
                    else if (arr[0] === 0x89 && arr[1] === 0x50 && arr[2] === 0x4E && arr[3] === 0x47) {
                        mimeType = 'image/png';
                        console.log('Detected: PNG');
                    }
                    // Check HEIC/HEIF: ftyp at offset 4
                    else if (arr[4] === 0x66 && arr[5] === 0x74 && arr[6] === 0x79 && arr[7] === 0x70) {
                        mimeType = 'image/heic';
                        console.log('Detected: HEIC - ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô Browser!');
                        showMessage(`‚ùå ‡πÑ‡∏ü‡∏•‡πå ${filename} ‡πÄ‡∏õ‡πá‡∏ô HEIC (iPhone) - Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JPG ‡∏Å‡πà‡∏≠‡∏ô`, 'info');
                        return;
                    }
                    // Check WebP: RIFF....WEBP
                    else if (arr[0] === 0x52 && arr[1] === 0x49 && arr[2] === 0x46 && arr[3] === 0x46) {
                        mimeType = 'image/webp';
                        console.log('Detected: WebP');
                    }
                    else {
                        console.log('Unknown format, magic bytes:', Array.from(arr.slice(0, 8)).map(b => b.toString(16).padStart(2, '0')).join(' '));
                    }
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Blob ‡∏û‡∏£‡πâ‡∏≠‡∏° MIME type ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    const blob = new Blob([arrayBuffer], { type: mimeType });
                    originalSize = blob.size;
                    console.log('Created blob:', blob.size, 'bytes, type:', blob.type);
                    
                    // ‡πÉ‡∏ä‡πâ FileReader ‡πÅ‡∏ó‡∏ô URL.createObjectURL
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        console.log('FileReader result length:', e.target.result.length);
                        
                        const img = new Image();
                        img.onload = function() {
                            console.log('Image loaded successfully:', img.width, 'x', img.height);
                            originalImage = img;
                            showOriginal(img, originalSize);
                            showMessage(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏ô‡∏≤‡∏î: ${(originalSize/1024).toFixed(0)} KB (${img.width}x${img.height})`, 'success');
                            
                            setTimeout(() => {
                                compressImage();
                            }, 200);
                        };
                        
                        img.onerror = function(err) {
                            console.error('Image decode error:', err);
                            console.log('Data URL prefix:', e.target.result.substring(0, 50));
                            showMessage(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ - ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≤‡∏à‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô HEIC`, 'info');
                        };
                        
                        img.src = e.target.result;
                    };
                    
                    reader.onerror = function(err) {
                        console.error('FileReader error:', err);
                        showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô blob ‡πÑ‡∏î‡πâ', 'info');
                    };
                    
                    reader.readAsDataURL(blob);
                })
                .catch(err => {
                    console.error('Fetch error:', err);
                    showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î ${filename} ‡πÑ‡∏î‡πâ: ${err.message}`, 'info');
                });
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            console.log('File selected:', file.name, file.type, file.size);
            showMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`, 'info');
            
            loadImage(file);
        });

        function loadImage(file) {
            originalSize = file.size;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                console.log('FileReader loaded, data length:', e.target.result.length);
                
                const img = new Image();
                
                img.onload = function() {
                    console.log('Image loaded:', img.width, 'x', img.height);
                    originalImage = img;
                    showOriginal(img, file.size);
                    showMessage(`‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏ô‡∏≤‡∏î: ${img.width}x${img.height}`, 'success');
                    
                    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î
                    setTimeout(() => {
                        compressImage();
                    }, 100);
                };
                
                img.onerror = function(err) {
                    console.error('Image load error:', err);
                    showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ HEIC ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ JPG ‡∏´‡∏£‡∏∑‡∏≠ PNG', 'info');
                };
                
                img.src = e.target.result;
            };
            
            reader.onerror = function(err) {
                console.error('FileReader error:', err);
                showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ', 'info');
            };
            
            reader.readAsDataURL(file);
        }

        function createDemo() {
            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Demo...', 'info');
            const canvas = document.createElement('canvas');
            canvas.width = 1920;
            canvas.height = 1440;
            const ctx = canvas.getContext('2d');

            // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            const grad = ctx.createLinearGradient(0, 0, 1920, 1440);
            grad.addColorStop(0, '#667eea');
            grad.addColorStop(1, '#764ba2');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 1920, 1440);

            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            ctx.fillStyle = 'white';
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Bait Check-In', 960, 400);

            ctx.font = '50px Arial';
            ctx.fillText('‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Demo', 960, 550);

            ctx.font = '40px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ABC Company', 100, 750);
            ctx.fillText('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤: 2025-001234', 100, 850);
            ctx.fillText('‡πÄ‡∏Ç‡∏ï: ‡πÄ‡∏Ç‡∏ï 1 | ‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•', 100, 950);
            ctx.fillText('GPS: 13.7563, 100.5018', 100, 1050);
            ctx.fillText('‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: 10 ‡πÄ‡∏°‡∏ï‡∏£', 100, 1150);

            canvas.toBlob((blob) => {
                const file = new File([blob], 'demo.jpg', { type: 'image/jpeg' });
                loadImage(file);
                showMessage('‡∏™‡∏£‡πâ‡∏≤‡∏á Demo ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }, 'image/jpeg', 0.9);
        }

        function showOriginal(img, size) {
            const display = document.getElementById('originalDisplay');
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á img element ‡πÉ‡∏´‡∏°‡πà
            const newImg = document.createElement('img');
            newImg.src = img.src;
            newImg.alt = 'Original';
            newImg.style.cssText = 'max-width: 100%; max-height: 100%; object-fit: contain;';
            
            display.innerHTML = '';
            display.appendChild(newImg);
            
            document.getElementById('origSize').textContent = (size / 1024).toFixed(2) + ' KB';
            document.getElementById('origWidth').textContent = img.width + ' px';
            document.getElementById('origHeight').textContent = img.height + ' px';
            
            console.log('Original displayed:', (size / 1024).toFixed(2), 'KB');
        }

        function compressImage() {
            if (!originalImage) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Demo ‡∏Å‡πà‡∏≠‡∏ô', 'info');
                return;
            }

            console.log('Starting compression...', originalImage.width, 'x', originalImage.height);
            showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î...', 'info');

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á canvas ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ
            const canvas = document.createElement('canvas');
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

            console.log('Canvas created:', canvas.width, 'x', canvas.height);

            let quality = 0.85;
            const targetSize = 120 * 1024;

            const tryCompress = () => {
                console.log('Trying quality:', quality);
                
                canvas.toBlob((blob) => {
                    if (!blob) {
                        console.error('Blob is null!');
                        showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î', 'info');
                        return;
                    }

                    console.log('Blob created:', blob.size, 'bytes at quality', quality);

                    if (blob.size > targetSize && quality > 0.2) {
                        quality -= 0.05;
                        tryCompress();
                    } else {
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß
                        const url = URL.createObjectURL(blob);
                        console.log('Created URL:', url);
                        
                        const compImg = new Image();
                        compImg.onload = () => {
                            console.log('Compressed image loaded');
                            const display = document.getElementById('compressedDisplay');
                            display.innerHTML = '';
                            
                            compImg.style.cssText = 'max-width: 100%; max-height: 100%; object-fit: contain;';
                            display.appendChild(compImg);
                            
                            document.getElementById('compSize').textContent = (blob.size / 1024).toFixed(2) + ' KB';
                            document.getElementById('compWidth').textContent = canvas.width + ' px';
                            document.getElementById('compHeight').textContent = canvas.height + ' px';
                            
                            updateStats(originalSize, blob.size);
                            showMessage(`‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏ô‡∏≤‡∏î: ${(blob.size / 1024).toFixed(2)} KB (quality: ${(quality * 100).toFixed(0)}%)`, 'success');
                        };
                        compImg.onerror = (err) => {
                            console.error('Compressed image load error:', err);
                            showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏î‡πâ', 'info');
                        };
                        compImg.src = url;
                    }
                }, 'image/jpeg', quality);
            };

            tryCompress();
        }

        function showCompressed(dataUrl, fileSize, width, height) {
            console.log('showCompressed called');
            const display = document.getElementById('compressedDisplay');
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = 'Compressed';
            img.style.cssText = 'max-width: 100%; max-height: 100%; object-fit: contain;';
            
            display.innerHTML = '';
            display.appendChild(img);
            
            document.getElementById('compSize').textContent = (fileSize / 1024).toFixed(2) + ' KB';
            document.getElementById('compWidth').textContent = width + ' px';
            document.getElementById('compHeight').textContent = height + ' px';
        }

        function updateStats(orig, comp) {
            const ratio = ((1 - comp / orig) * 100).toFixed(1);
            const diff = ((orig - comp) / 1024).toFixed(2);
            const uploadTime = ((comp / 8) / 2).toFixed(1);
            const monthly = ((2500 * 2 * (comp / 1024)) / 1024).toFixed(2);

            document.getElementById('ratio').textContent = ratio + '%';
            document.getElementById('diff').textContent = diff + ' KB';
            document.getElementById('uploadTime').textContent = uploadTime + ' s';
            document.getElementById('monthlyUsage').textContent = monthly + ' GB';
        }

        function showMessage(text, type) {
            const area = document.getElementById('messageArea');
            area.innerHTML = `<div class="message ${type}">${text}</div>`;
        }

        function resetAll() {
            document.getElementById('fileInput').value = '';
            originalImage = null;
            originalSize = 0;
            
            document.getElementById('originalDisplay').innerHTML = '<p style="color: #999;">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...</p>';
            document.getElementById('compressedDisplay').innerHTML = '<p style="color: #999;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î...</p>';
            
            document.getElementById('origSize').textContent = '-';
            document.getElementById('origWidth').textContent = '-';
            document.getElementById('origHeight').textContent = '-';
            document.getElementById('compSize').textContent = '-';
            document.getElementById('compWidth').textContent = '-';
            document.getElementById('compHeight').textContent = '-';
            
            document.getElementById('ratio').textContent = '-';
            document.getElementById('diff').textContent = '-';
            document.getElementById('uploadTime').textContent = '-';
            document.getElementById('monthlyUsage').textContent = '-';
            
            document.getElementById('messageArea').innerHTML = '';
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
</body>
</html>
