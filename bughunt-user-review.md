<!-- markdownlint-disable MD024 -->
# Bug Hunt & UX Review Summary

โปรเจกต์: **Bait Check-In WebApp**  
ฐานอ้างอิง: `task.md` (สถานะ V2.1.0, 01-02-2026)

---

## 1. มุมมองผู้ใช้ (User) – Mobile Check-in

### 1.1 Permission: Location / Camera

#### อาการที่เสี่ยง

- ผู้ใช้ปฏิเสธสิทธิ์ Location หรือ Camera แต่ยังสามารถกด Check-in ต่อได้ หรือมีเพียง Toast เล็ก ๆ บอก
- ผู้ใช้ไม่รู้ว่าระบบ **ไม่ได้บันทึกตำแหน่งหรือรูป** จริง

#### ข้อเสนอแนะ

- ถ้า Location หรือ Camera ไม่พร้อม:
  - ปิดปุ่ม **Check-in** (Disabled) พร้อมข้อความเตือนขนาดใหญ่
  - แสดงปุ่ม "ลองใหม่" เพื่อขอ permission ซ้ำ หรืออธิบายวิธีเปิดสิทธิ์ใน Browser settings
- แยก state ให้ชัดเจน (Ready / Not Ready) ไม่ให้ user เดาเอง

---

### 1.2 การบังคับกรอกฟอร์ม & รูป

#### อาการที่เสี่ยง

- ผู้ใช้ไม่รู้ว่าต้องกรอกช่องไหนบังคับบ้าง (ชื่อลูกค้า, เลขสัญญา, สาขา)
- ไม่แน่ใจว่าต้องแนบรูปกี่รูป (อย่างน้อย 1 หรือ 2 รูป หรือไม่บังคับ)
- หาก validation ไม่เข้มงวด → ข้อมูลใน Dashboard ไม่ครบถ้วน

#### ข้อเสนอแนะ

- ใส่เครื่องหมาย `*` ที่ label ช่องจำเป็น พร้อมคำอธิบายใต้ช่อง (helper text)
- ถ้าขาดข้อมูลบังคับ:
  - **ห้ามส่งฟอร์ม** และแสดงข้อความผิดพลาดใต้ช่องนั้น (ไม่พึ่ง Toast อย่างเดียว)
- ถ้าต้องบังคับรูป:
  - ปิดปุ่ม Check-in จนกว่าจะมีรูปครบตามเงื่อนไข

---

### 1.3 GPS ช้า / ไม่แม่นยำ

#### อาการที่เสี่ยง

- ได้ตำแหน่งช้า หรือค่า accuracy สูง (ตำแหน่งไม่แม่น) โดยผู้ใช้ไม่เข้าใจว่าเกิดอะไรขึ้น
- ผู้ใช้คิดว่าแอปค้าง/เสีย

#### ข้อเสนอแนะ

- ขณะกำลังหาตำแหน่ง แสดงข้อความเช่น:
  - "กำลังหาตำแหน่ง… อาจใช้เวลา 5–10 วินาที"
- มีปุ่ม "ลองหาตำแหน่งใหม่" เมื่อเกินเวลาที่กำหนด (timeout)
- ถ้า accuracy แย่เกิน threshold ที่กำหนด:
  - แสดงคำเตือนว่า "สัญญาณ GPS อาจไม่แม่นยำ มีโอกาสคลาดเคลื่อน"

---

### 1.4 คุณภาพรูป & ขนาดไฟล์ (Compression)

#### อาการที่เสี่ยง

- แม้กำหนด Quality 50–90% และ Max Width 800/1200/1600 แต่ขนาดจริงของไฟล์อาจยังเกิน 500KB
- หากเกิน limit โดยไม่มีการจัดการ → Upload ไป Storage ล้มเหลว โดยผู้ใช้ไม่รู้สาเหตุ

#### ข้อเสนอแนะ

- หลังบีบอัดรูปแล้ว ให้แสดง **ขนาดไฟล์โดยประมาณ** ต่อรูป (เช่น `~320 KB`)
- ถ้าขนาดเกิน threshold (เช่น > 480KB):
  - ลดคุณภาพ/ความละเอียดอัตโนมัติอีกครั้งจนผ่านเกณฑ์
  - หรือแสดงข้อความอธิบาย และไม่ให้กด Check-in จนกว่าระบบจะปรับสำเร็จ
- ข้อผิดพลาดเกี่ยวกับขนาดไฟล์ต้องเป็น Error ที่อ่านง่าย เช่น:
  - "รูปใหญ่เกินไป ระบบลดขนาดให้อัตโนมัติแล้ว กรุณาตรวจสอบอีกครั้ง"

---

### 1.5 Local History vs ข้อมูลจริงใน Firestore

#### อาการที่เสี่ยง

- ประวัติในมือถือใช้ `localStorage` เก็บ ซึ่งอาจไม่สอดคล้องกับ Firestore ทุกครั้ง เช่น:
  - บันทึก Firestore สำเร็จแต่เขียน localStorage ล้มเหลว → User ไม่เห็นในหน้าประวัติ
  - บันทึก localStorage สำเร็จ แต่ write ไป Firestore fail → User คิดว่าสำเร็จแต่ Dashboard ไม่มีข้อมูล

#### ข้อเสนอแนะ

- ให้สถานะของแต่ละรายการใน Local History ชัดเจน เช่น Badge:
  - "ซิงค์แล้ว" (Synced)
  - "กำลังส่ง…" (Pending)
  - "ส่งไม่สำเร็จ กดเพื่อลองใหม่" (Failed + retry)
- ถ้าออกแบบแนว offline-first:
  - สร้าง queue สำหรับรายการที่รอส่ง และมี logic retry

---

### 1.6 การใช้ Toast แจ้งเตือนเยอะเกินไป

#### อาการที่เสี่ยง

- ใช้ Toast สำหรับทุกประเภทแจ้งเตือน (success/error/info/offline/online)
- Toast หลายอันซ้อนกัน ผู้ใช้มองไม่ทัน ไม่รู้ว่าอันไหนสำคัญ

#### ข้อเสนอแนะ

- แยกความสำคัญ:
  - Error สำคัญ (เช่น บันทึก Firestore ไม่สำเร็จ) → ใช้ Modal เต็มจอ + ปุ่มยืนยัน
  - Toast สำหรับข้อความสั้น/ไม่ critical
- จำกัดจำนวน Toast แสดงพร้อมกัน (เช่น สูงสุด 1–2 รายการ)
- ใช้สีสื่อความหมายคงที่ (เขียว=สำเร็จ, แดง=ผิดพลาด, เหลือง=คำเตือน)

---

### 1.7 การจำทีม (Team-based Login) และเปลี่ยนเครื่อง

#### อาการที่เสี่ยง

- ระบบจำทีมด้วย localStorage
- เมื่อเปลี่ยนเครื่อง/เบราว์เซอร์ หรือเคลียร์ cache:
  - ผู้ใช้อาจต้องเลือกทีมใหม่ โดยไม่ทันสังเกต → ใช้ทีมผิดพลาดได้

#### ข้อเสนอแนะ

- แสดงทีมปัจจุบันอย่างชัดเจนทุกครั้งบนหน้าหลัก เช่น:
  - "กำลังเช็คอินในนามทีม: TEAM A"
- ทำปุ่ม "เปลี่ยนทีม" ให้มองเห็นง่าย
- ก่อน Check-in อาจแสดง popover เล็ก ๆ ยืนยันทีมอีกครั้งในกรณีมีหลาย user ใช้เครื่องเดียวกัน

---

## 2. มุมมองผู้ใช้ – Desktop Admin Dashboard

### 2.1 การใช้ Filter หลายเงื่อนไขพร้อมกัน

#### อาการที่เสี่ยง

- มี Filter ทั้ง ทีม, เขต, สาขา, วันที่
- เมื่อใส่หลายเงื่อนไขพร้อมกัน ง่ายมากที่จะกรอกผิดเพียงหนึ่งช่องแล้วได้ผลลัพธ์ = ว่าง
- ผู้ใช้มักสรุปทันทีว่า "ระบบพัง" แทนที่จะสงสัย Filter

#### ข้อเสนอแนะ

- แสดงแถบ "Filter ที่ใช้งานอยู่" อย่างชัดเจนด้านบน (summary chips/badges)
- ทำปุ่ม "ล้างตัวกรองทั้งหมด (Reset Filters)" ให้โดดเด่น
- ถ้าไม่มีผลลัพธ์:
  - แสดงข้อความชัดเจน เช่น "ไม่พบข้อมูลในช่วงตัวกรองปัจจุบัน" แทนหน้าเปล่า ๆ

---

### 2.2 Sort + Filter + Real-time Update ทำให้ตาราง/แผนที่กระโดด

#### อาการที่เสี่ยง

- Dashboard ดึงข้อมูลแบบ real-time จาก Firestore
- ขณะผู้ใช้กำลัง scroll หรือดูข้อมูลอยู่:
  - มี record ใหม่เข้ามา หรือข้อมูลบางส่วนเปลี่ยน
  - ตาราง/ลิสต์อาจกระโดด, แถวเลื่อนเอง, แถวที่กำลังจะคลิกหายไป

#### ข้อเสนอแนะ

- ถ้า user กำลังดูข้อมูลด้วย Filter/Sort ที่ตั้งเอง:
  - เก็บ real-time update ไว้ และแสดง notification เล็ก ๆ เช่น
    - "มีข้อมูลใหม่ X รายการ — คลิกเพื่อรีเฟรช"
  - ให้ผู้ใช้เป็นคนตัดสินใจรีเฟรชเอง แทนการแทรกแถวอัตโนมัติ

---

### 2.3 UX เครื่องมือวัดระยะ & วงกลมรัศมีในแผนที่

#### อาการที่เสี่ยง

- Multi-point measurement และ Radius tool ใช้งานยากหากไม่มีคำอธิบาย
- ผู้ใช้ไม่รู้วิธี:
  - เริ่มการวัด
  - จบการวัด
  - ลบเส้นหรือลบวงกลมที่เคยวาด

#### ข้อเสนอแนะ

- แสดง Hint บนแผนที่ หรือ tooltip ใกล้ปุ่มเครื่องมือ เช่น:
  - "คลิกบนแผนที่เพื่อเพิ่มจุด, ดับเบิลคลิกเพื่อจบการวัด"
  - "ลากจุดเพื่อปรับตำแหน่ง, คลิกไอคอนถังขยะเพื่อลบเส้น/วง"
- มีปุ่ม "ล้างการวัดทั้งหมด" ที่ใช้งานง่าย

---

### 2.4 Export Excel/CSV/PDF กับข้อมูลจำนวนมาก

#### อาการที่เสี่ยง

- หากโปรเจกต์ใช้งานจริงและมีข้อมูลหลายพัน/หมื่นรายการ:
  - การดึงข้อมูลทั้งหมดขึ้นมาหน้าจอแล้ว export ฝั่ง client อาจทำให้ browser ช้า/ค้าง

#### ข้อเสนอแนะ

- จำกัดการ export ตามเงื่อนไข:
  - ค่าเริ่มต้น: export เฉพาะข้อมูลภายใต้ Filter ปัจจุบัน
  - ถ้าจำนวน record > N (เช่น 2,000): แจ้งเตือนว่าข้อมูลเยอะมาก และอาจใช้เวลานาน
- ตรวจจับ error ระหว่าง export (เช่น memory เต็ม) และแสดงข้อความแทนการค้างเงียบ ๆ

---

### 2.5 Toggle Visibility หมุดบนแผนที่ถูกบันทึกลง Firestore

#### อาการที่เสี่ยง

- ถ้า visibility บันทึกเป็น "global" ใน Firestore:
  - แอดมิน A ซ่อนทีม B → แอดมิน B ที่ใช้งานอีกหน้าจอหนึ่งก็ไม่เห็นทีม B ด้วย
- อาจขัดกับความคาดหวังของผู้ใช้บางคนที่คิดว่านี่เป็นแค่ filter ส่วนตัว

#### ข้อเสนอแนะ

- ถ้าต้องการ "มุมมองส่วนตัว":
  - เก็บสถานะซ่อน/แสดงหมุดที่ `localStorage` หรือ state ฝั่ง client เท่านั้น ไม่เขียนกลับ Firestore
- ถ้าต้องการให้เป็น "มุมมองร่วมกัน" จริง ๆ:
  - แสดงข้อความชัดเจนขณะเปลี่ยนค่า เช่น "การเปลี่ยนนี้มีผลกับผู้ใช้ทุกคน"

---

### 2.6 Longdo Map API Limit (1K/วัน)

#### อาการที่เสี่ยง

- หากเรียก Reverse Geocoding ของ Longdo ทุกครั้งที่มีจุดใหม่ หรือทุกการ refresh
  - เสี่ยงเกิน quota → ที่อยู่ไม่โหลด, ขึ้น error จาก API

#### ข้อเสนอแนะ

- ทำ Cache ตามคู่ (lat,lng) → address:
  - เก็บใน Firestore หรือ localStorage
  - ถ้ามีข้อมูลซ้ำ lat,lng เดิม ไม่ต้องเรียก API ใหม่
- ถ้า Longdo ตอบ error:
  - แสดงข้อความเช่น "ไม่สามารถโหลดที่อยู่ได้" แทนการโชว์ข้อความ error ตรง ๆ จาก API

---

## 3. มุมมอง Bug Hunter – ความเสี่ยงเชิงเทคนิค

### 3.1 Security Rules: Development vs Production

#### อาการที่เสี่ยง

- จาก `task.md` ระบุว่ามีทั้ง Development Mode และ Production Rules ที่ "Open สำหรับ Internal Use"
- หาก rules เปิดกว้างเกินไป (เช่น `allow read, write: if true;`) แม้ตั้งใจใช้ภายใน แต่ตัวเว็บอยู่บน public URL → ใครก็ยิง API ได้

#### ข้อเสนอแนะ

- ตรวจไฟล์:
  - `firebase/firestore.rules`
  - `firebase/storage.rules`
- ยืนยันว่ามีการจำกัด:
  - สิทธิ์การเขียนเฉพาะรูปแบบข้อมูลหรือ collection ที่ต้องการจริง ๆ
  - ถ้ามี Auth ให้ผูกสิทธิ์กับ `request.auth` โดยเฉพาะ
- หากไม่มี Firebase Auth และใช้เพียง team-based login ฝั่ง client:
  - หลีกเลี่ยงการเปิด write จาก client ตรง ๆ โดยไม่มีเงื่อนไข

---

### 3.2 Team-based Login โดยไม่ใช้ Firebase Auth จริง

#### อาการที่เสี่ยง

- ถ้าเลือกทีมแค่ใน UI แล้วส่งค่า `team` ไปบันทึกใน Firestore ตรง ๆ โดยไม่มีการยืนยันฝั่ง server:
  - ผู้โจมตีสามารถใช้ DevTools แก้ค่า `team` ใน payload แล้วส่งข้อมูลปลอมได้

#### ข้อเสนอแนะ

- ถ้าต้องการความปลอดภัยจริง:
  - ใช้ Firebase Auth (แม้จะใช้เป็น Anonymous Auth + Custom Claim สำหรับทีมก็ได้)
  - Security Rules ตรวจสอบสิทธิ์จาก `request.auth` ไม่ใช่เชื่อค่าทีมที่มาจาก client เพียงอย่างเดียว

---

### 3.3 การใช้ Timestamp และ Timezone

#### อาการที่เสี่ยง

- Field: `checkinTime`, `createdAt`, `updatedAt` เป็น `timestamp`
- หากใช้ `new Date()` จากเครื่องผู้ใช้:
  - ผู้ใช้ตั้ง timezone หรือเวลาเครื่องผิด → ข้อมูลเวลาเพี้ยน
- หากไม่ได้ใช้ `serverTimestamp()`:
  - การเรียงลำดับตามเวลา (sort) อาจผิดจาก latency ของ network

#### ข้อเสนอแนะ

- ใช้ `serverTimestamp()` ของ Firestore สำหรับเวลาที่สำคัญทุก field
- ฝั่งแสดงผล:
  - แปลงเวลาจาก UTC → Asia/Bangkok เสมอ
- หลีกเลี่ยงการใช้เวลาจากเครื่อง user สำหรับ logic เช่น filter ข้อมูลตามวัน

---

### 3.4 Offline/Online Detection

#### อาการที่เสี่ยง

- หากเครือข่ายแกว่ง (สลับ online/offline บ่อย ๆ):
  - Toast แจ้งเตือนอาจเด้งรัว รบกวนการใช้งาน

#### ข้อเสนอแนะ

- Debounce/Throttle สถานะ online/offline:
  - ต้อง offline ต่อเนื่องเกิน X วินาที (เช่น 5s) จึงเปลี่ยนสถานะจริง
- ถ้า offline ระหว่าง upload หรือ check-in:
  - ให้สถานะ "pending" ชัดเจน และมีระบบ retry เมื่อกลับมา online

---

### 3.5 การจัดเก็บ URL รูปใน Firestore

#### อาการที่เสี่ยง

- `photos` เก็บเป็น string (น่าจะเป็น URL หรือ path)
- ถ้าเก็บเป็น Public URL ตรง ๆ:
  - เปลี่ยนโครงสร้าง Storage หรือ Bucket ภายหลังลำบาก (ต้องแก้ทุก doc)

#### ข้อเสนอแนะ

- เก็บเป็น path ภายใน Storage เช่น
  - `photos/TEAM/DATE/filename.jpg`
- เวลาแสดงผล จึงค่อยเรียก `getDownloadURL()` จาก path
- ช่วยเรื่องย้าย bucket/แก้ rules ในอนาคตได้ง่ายกว่า

---

## 4. สรุปประเด็นสำคัญเชิงปฏิบัติ

### ด้าน UX – Mobile

- ทำ validation ฟอร์ม + รูปให้ชัดเจน, ปิดปุ่ม Check-in เมื่อข้อมูลยังไม่พร้อม
- จัดการ permission (Location/Camera) ด้วย UI ที่ชัด ไม่ปล่อยให้ user เดา
- แสดงสถานะรูป (ขนาด/คุณภาพ) และบังคับไม่ให้เกิน limit ที่ Storage รับได้
- จัดการ Local History ให้บอกสถานะ sync กับ server อย่างโปร่งใส

### ด้าน UX – Dashboard

- จัดการ Filter + Real-time update ไม่ให้ทำให้ข้อมูลบนจอ "กระโดด" เอง
- ใส่คำอธิบายการใช้เครื่องมือวัดระยะ/รัศมีบนแผนที่ให้ชัด
- จำกัด/ควบคุมการ Export บนชุดข้อมูลขนาดใหญ่
- แยกมุมมองส่วนตัว (client-side) กับมุมมองร่วมกัน (server-side) ให้ชัด โดยเฉพาะการซ่อน/แสดงหมุด

### ด้านความปลอดภัย & ความถูกต้องของข้อมูล

- ตรวจสอบปรับปรุง Firestore/Storage Rules ไม่ให้เปิดกว้างเกินจำเป็น
- หากต้องการความปลอดภัยมากขึ้น ควรใช้ Firebase Auth ผนวกกับ team-based login
- ใช้ `serverTimestamp()` เป็นแหล่งเวลาเดียว และจัดการ timezone ฝั่ง UI
- ออกแบบ offline/online และคิวการส่งข้อมูลให้เชื่อถือได้ในสภาพเครือข่ายจริง

---

ไฟล์นี้สามารถใช้เป็น checklist สำหรับรอบแก้ไขถัดไป และเป็นเอกสารอ้างอิงในขั้นตอนรีวิวคุณภาพ (QA/UAT) ของระบบ Bait Check-In WebApp ได้โดยตรง.
