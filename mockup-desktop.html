<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bait Check-In | Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --primary-light: #7dd3fc;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --sidebar-bg: #0f172a;
            --sidebar-hover: #1e293b;
            --bg-main: #f1f5f9;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --border: #e2e8f0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
        }

        /* Dark mode removed per requirements */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            color: var(--text-primary);
        }

        /* Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar - Collapsible Animation */
        .sidebar {
            width: 72px;
            background: var(--sidebar-bg);
            color: white;
            padding: 16px 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .sidebar:hover {
            width: 260px;
        }

        .sidebar:hover .logo-text,
        .sidebar:hover .nav-text {
            opacity: 1;
            transform: translateX(0);
        }

        .sidebar:hover .logo {
            padding: 0 24px 20px;
        }

        .sidebar:hover .nav-item {
            padding: 14px 24px;
        }

        .logo {
            padding: 0 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 16px;
            transition: padding 0.3s ease;
            white-space: nowrap;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-text {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease 0.1s;
        }

        .logo h1 i {
            color: var(--primary);
        }

        /* Speed Motion Logo */
        .app-logo {
            width: 40px;
            height: 34px;
            min-width: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transform: skew(-10deg);
            background: var(--primary);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);
        }
        .app-logo i {
            color: white !important;
            font-size: 20px;
            transform: skew(10deg);
        }

        .nav-menu {
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            white-space: nowrap;
            position: relative;
        }

        .nav-text {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease 0.1s;
        }

        .nav-item:hover {
            background: var(--sidebar-hover);
            color: white;
        }

        .nav-item.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--primary);
        }

        .nav-item i {
            width: 24px;
            min-width: 24px;
            text-align: center;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .nav-item:hover i {
            transform: scale(1.1);
        }

        /* Tooltip for collapsed sidebar */
        .nav-item::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 72px;
            background: var(--sidebar-bg);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .sidebar:not(:hover) .nav-item:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Team Badges */
        .team-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
        }

        .team-badge.team-a { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .team-badge.team-b { background: linear-gradient(135deg, #10b981, #059669); }
        .team-badge.team-c { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .team-badge.team-d { background: linear-gradient(135deg, #0ea5e9, #0284c7); }
        .team-badge.team-e { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .team-badge.team-f { background: linear-gradient(135deg, #ec4899, #db2777); }
        .team-badge.team-g { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .team-badge.team-h { background: linear-gradient(135deg, #84cc16, #65a30d); }
        .team-badge.team-i { background: linear-gradient(135deg, #f97316, #ea580c); }
        .team-badge.team-j { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .team-badge.team-k { background: linear-gradient(135deg, #14b8a6, #0d9488); }
        .team-badge.team-l { background: linear-gradient(135deg, #a855f7, #9333ea); }
        .team-badge.team-m { background: linear-gradient(135deg, #f43f5e, #e11d48); }
        .team-badge.team-n { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .team-badge.team-o { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .team-badge.team-z { background: linear-gradient(135deg, #1e1e1e, #3d3d3d); }

        .team-badge-sm {
            width: 24px;
            height: 24px;
            font-size: 0.7rem;
            border-radius: 6px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 72px;
            padding: 24px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Sidebar Expand Indicator */
        .sidebar-expand-hint {
            position: fixed;
            left: 72px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 60px;
            background: linear-gradient(to right, rgba(30, 41, 59, 0.3), transparent);
            border-radius: 0 8px 8px 0;
            z-index: 99;
            pointer-events: none;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover ~ .sidebar-expand-hint,
        .sidebar-expand-hint:hover {
            opacity: 0;
        }

        /* Top Header */
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            background: var(--bg-card);
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .search-box {
            position: relative;
            width: 320px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            font-family: 'Prompt', sans-serif;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .theme-toggle {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: 2px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .notification-btn {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: none;
            background: var(--bg-main);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .notification-btn:hover {
            background: var(--primary);
            color: white;
        }

        .notification-btn .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background: var(--danger);
            border-radius: 50%;
            font-size: 0.7rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--bg-main);
            border-radius: 12px;
            cursor: pointer;
        }

        .admin-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .admin-info {
            text-align: left;
        }

        .admin-info .name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .admin-info .role {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Stat Cards */
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.blue {
            background: rgba(14, 165, 233, 0.1);
            color: var(--primary);
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .stat-icon.orange {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-icon.purple {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
            line-height: 1;
        }

        .stat-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .stat-trend {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
        }

        .stat-trend.up {
            color: var(--success);
        }

        .stat-trend.down {
            color: var(--danger);
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 24px;
        }

        /* Map Section */
        .map-section {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .section-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header h2 i {
            color: var(--primary);
        }

        .header-actions-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        #map {
            height: 450px;
            width: 100%;
        }

        /* Leaflet zoom controls - ให้อยู่ต่ำกว่า sidebar */
        .leaflet-control-container .leaflet-top,
        .leaflet-control-container .leaflet-left {
            z-index: 500 !important;
        }

        .leaflet-control-zoom {
            z-index: 500 !important;
        }

        /* Checkins List */
        .checkins-section {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            max-height: 550px;
        }

        .checkins-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
        }

        .checkin-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            background: var(--bg-main);
            transition: all 0.3s ease;
        }

        .checkin-item:hover {
            background: rgba(14, 165, 233, 0.05);
        }

        .checkin-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-light), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }

        .checkin-info {
            flex: 1;
        }

        .checkin-info .name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .checkin-info .location {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkin-info .time {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .checkin-info .time .actual-time {
            color: var(--primary);
            font-weight: 500;
        }

        .checkin-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .checkin-status.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .checkin-status.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .checkin-status.inactive {
            background: rgba(100, 116, 139, 0.1);
            color: var(--text-secondary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            border-radius: 26px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        /* Toggle switch in table - ensure proper display */
        .data-table .toggle-switch {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .data-table .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--accent)) !important;
        }

        /* Table View */
        .table-section {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-top: 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 16px 20px;
            text-align: left;
        }

        .data-table th {
            background: var(--bg-main);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table th:first-child {
            border-radius: 12px 0 0 0;
        }

        .data-table th:last-child {
            border-radius: 0 12px 0 0;
        }

        .data-table td {
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover td {
            background: rgba(14, 165, 233, 0.02);
        }

        .visibility-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Filter Panel */
        .filter-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            display: none;
        }

        .filter-panel.active {
            display: block;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: 'Prompt', sans-serif;
            background: white;
            transition: all 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Distance Panel */
        .distance-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            min-width: 280px;
            display: none;
        }

        .distance-panel.active {
            display: block;
        }

        .distance-panel h4 {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .distance-panel h4 i {
            color: var(--primary);
        }

        .distance-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .distance-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
        }

        .distance-value span {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .btn-measure {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
        }

        .btn-measure.active {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-measure:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        /* Map container for distance panel positioning */
        .map-container {
            position: relative;
        }

        /* Photo Gallery Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h2 i {
            color: var(--primary);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: var(--bg-main);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 24px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 4/3;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gallery-item:hover {
            transform: scale(1.02);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item .gallery-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
        }

        .gallery-item .gallery-info .name {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .gallery-item .gallery-info .meta {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Image Viewer */
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .image-viewer.active {
            display: flex;
        }

        .image-viewer img {
            max-width: 90%;
            max-height: 80%;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        .image-viewer .viewer-info {
            color: white;
            text-align: center;
            margin-top: 20px;
        }

        .image-viewer .viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-viewer .viewer-close:hover {
            background: var(--danger);
        }

        /* Charts Container */
        .chart-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-header h3 i {
            color: var(--primary);
        }

        .chart-wrapper {
            height: 250px;
            position: relative;
        }

        /* Bar Chart (CSS-based) */
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding: 20px 0;
            border-bottom: 2px solid var(--border);
        }

        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .bar {
            width: 40px;
            border-radius: 8px 8px 0 0;
            background: linear-gradient(to top, var(--primary), var(--accent));
            transition: height 0.5s ease;
            position: relative;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .bar-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Donut Chart (CSS-based) */
        .donut-chart {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            position: relative;
            margin: 0 auto;
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: var(--bg-card);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .donut-center .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .donut-center .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Real-time Indicator */
        .realtime-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--success);
        }

        .realtime-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Export Dropdown */
        .export-dropdown {
            position: relative;
        }

        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 180px;
            z-index: 100;
            display: none;
            overflow: hidden;
        }

        .export-menu.active {
            display: block;
        }

        .export-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9rem;
        }

        .export-menu-item:hover {
            background: var(--bg-main);
        }

        .export-menu-item i {
            width: 20px;
            color: var(--text-secondary);
        }

        .export-menu-item.excel i { color: #217346; }
        .export-menu-item.csv i { color: #0ea5e9; }
        .export-menu-item.pdf i { color: #ef4444; }

        /* Team Filter Dropdown */
        .team-filter-dropdown {
            position: relative;
        }

        .team-filter-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 8px;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 320px;
            z-index: 2000;
            display: none;
            overflow: visible;
        }

        .team-filter-menu.active {
            display: block;
        }

        .team-filter-header {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .btn-mini {
            padding: 4px 10px;
            font-size: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-main);
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            transition: all 0.2s ease;
        }

        .btn-mini:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .team-filter-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 16px;
        }

        .team-filter-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-main);
        }

        .team-filter-item:hover {
            background: rgba(14, 165, 233, 0.1);
        }

        .team-filter-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .team-filter-item input[type="checkbox"]:not(:checked) + .team-badge {
            opacity: 0.4;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1><span class="app-logo"><i class="fas fa-paper-plane"></i></span> <span class="logo-text">Bait Check-In</span></h1>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" data-page="dashboard" data-tooltip="Dashboard" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-pie"></i>
                    <span class="nav-text">Dashboard</span>
                </div>
                <div class="nav-item" data-page="mapview" data-tooltip="Map View" onclick="showPage('mapview')">
                    <i class="fas fa-map-location-dot"></i>
                    <span class="nav-text">Map View</span>
                </div>
                <div class="nav-item" data-page="checkins" data-tooltip="Check-ins List" onclick="showPage('checkins')">
                    <i class="fas fa-list-check"></i>
                    <span class="nav-text">Check-ins List</span>
                </div>
                <div class="nav-item" data-page="customers" data-tooltip="Customers" onclick="showPage('customers')">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">Customers</span>
                </div>
                <div class="nav-item" data-page="reports" data-tooltip="Reports" onclick="showPage('reports')">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">Reports</span>
                </div>
                <div class="nav-item" data-page="gallery" data-tooltip="Photo Gallery" onclick="showPage('gallery')">
                    <i class="fas fa-images"></i>
                    <span class="nav-text">Photo Gallery</span>
                </div>
                <div class="nav-item" data-page="settings" data-tooltip="Settings" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">Settings</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <div class="top-header">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="ค้นหาลูกค้า, สถานที่..." id="globalSearch" onkeyup="handleGlobalSearch(this.value)">
                </div>
                <div class="header-actions">
                    <!-- Real-time Indicator -->
                    <div class="realtime-badge" id="realtimeBadge">
                        <span class="realtime-dot"></span>
                        <span>Live</span>
                    </div>
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notificationCount">5</span>
                    </button>
                    <div class="admin-profile">
                        <div class="admin-avatar">JS</div>
                        <div class="admin-info">
                            <div class="name">John Smith</div>
                            <div class="role">Administrator</div>
                        </div>
                        <i class="fas fa-chevron-down" style="color: var(--text-secondary); font-size: 0.8rem;"></i>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div class="page-content" id="page-dashboard">
            <!-- Stat Cards -->
            <div class="stat-cards">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-location-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3>127</h3>
                        <p>Check-ins วันนี้</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> +12% จากเมื่อวาน
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-map-pin"></i>
                    </div>
                    <div class="stat-info">
                        <h3>89</h3>
                        <p>Active Locations</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> +5 ใหม่
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>2,456</h3>
                        <p>Total Customers</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> +23 สัปดาห์นี้
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <i class="fas fa-chart-simple"></i>
                    </div>
                    <div class="stat-info">
                        <h3>95.2%</h3>
                        <p>อัตราความสำเร็จ</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> +2.1%
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Filter Panel -->
                <div class="filter-panel" id="filterPanel">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label><i class="fas fa-users"></i> ทีม</label>
                            <select id="filterTeam">
                                <option value="all">ทั้งหมด</option>
                                <option value="A">Team A</option>
                                <option value="B">Team B</option>
                                <option value="C">Team C</option>
                                <option value="D">Team D</option>
                                <option value="E">Team E</option>
                                <option value="F">Team F</option>
                                <option value="G">Team G</option>
                                <option value="H">Team H</option>
                                <option value="I">Team I</option>
                                <option value="J">Team J</option>
                                <option value="K">Team K</option>
                                <option value="L">Team L</option>
                                <option value="M">Team M</option>
                                <option value="N">Team N</option>
                                <option value="O">Team O</option>
                                <option value="Z">Team Z</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label><i class="fas fa-map-marker-alt"></i> เขต</label>
                            <select id="filterZone">
                                <option value="all">ทั้งหมด</option>
                                <option value="เขต 1">เขต 1</option>
                                <option value="เขต 2">เขต 2</option>
                                <option value="เขต 3">เขต 3</option>
                                <option value="เขต 4">เขต 4</option>
                                <option value="เขต 5">เขต 5</option>
                                <option value="เขต 6">เขต 6</option>
                                <option value="เขต 7">เขต 7</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label><i class="fas fa-building"></i> สาขา</label>
                            <select id="filterBranch">
                                <option value="all">ทั้งหมด</option>
                                <optgroup label="เขต 1">
                                    <option>พุทธมณฑล</option>
                                    <option>นครปฐม</option>
                                    <option>หัวหิน</option>
                                    <option>พระราม 2</option>
                                </optgroup>
                                <optgroup label="เขต 2">
                                    <option>สาทร</option>
                                    <option>ปทุมวัน</option>
                                    <option>พระราม 4</option>
                                    <option>นนทบุรี</option>
                                </optgroup>
                                <optgroup label="เขต 3">
                                    <option>ปทุมธานี</option>
                                    <option>รามอินทรา</option>
                                    <option>อยุธยา</option>
                                </optgroup>
                                <optgroup label="เขต 4">
                                    <option>ลาดพร้าว</option>
                                    <option>พัฒนาการ</option>
                                    <option>สุวินทวงศ์</option>
                                    <option>ประชาชื่น</option>
                                </optgroup>
                                <optgroup label="เขต 5">
                                    <option>ปราจีนบุรี</option>
                                    <option>สมุทรปราการ</option>
                                    <option>พัทยา</option>
                                    <option>ระยอง</option>
                                </optgroup>
                                <optgroup label="เขต 6">
                                    <option>สุขุมวิท</option>
                                    <option>ปากน้ำ</option>
                                    <option>ชลบุรี</option>
                                </optgroup>
                                <optgroup label="เขต 7">
                                    <option>ปากช่อง</option>
                                    <option>สระบุรี</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label><i class="fas fa-calendar"></i> วันที่</label>
                            <input type="date" id="filterDate" value="2026-01-22">
                        </div>
                        <div class="filter-group">
                            <button class="btn btn-primary" onclick="applyFilters()" style="width: 100%;">
                                <i class="fas fa-search"></i> ค้นหา
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Map Section -->
                <div class="map-section">
                    <div class="section-header">
                        <h2><i class="fas fa-map"></i> Location Map</h2>
                        <div class="header-actions-group">
                            <button class="btn btn-outline" onclick="toggleFilter()">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="btn btn-measure" id="measureBtn" onclick="toggleMeasure()">
                                <i class="fas fa-ruler"></i> วัดระยะ
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-expand"></i> Full Screen
                            </button>
                        </div>
                    </div>
                    <div class="map-container">
                        <div id="map"></div>
                        <!-- Distance Panel -->
                        <div class="distance-panel" id="distancePanel">
                            <h4><i class="fas fa-ruler"></i> วัดระยะทาง</h4>
                            <div class="distance-info" id="distanceInfo">คลิกจุดแรกบนแผนที่...</div>
                            <div class="distance-value" id="distanceValue">-- <span>กม.</span></div>
                        </div>
                    </div>
                </div>

                <!-- Recent Check-ins -->
                <div class="checkins-section">
                    <div class="section-header">
                        <h2><i class="fas fa-clock-rotate-left"></i> Recent Check-ins</h2>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <!-- Team Filter for Map -->
                            <div class="team-filter-dropdown">
                                <button class="btn btn-outline" style="padding: 8px 14px;" onclick="toggleTeamFilterMenu()">
                                    <i class="fas fa-users"></i> ทีม <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 4px;"></i>
                                </button>
                                <div class="team-filter-menu" id="teamFilterMenu">
                                    <div class="team-filter-header">
                                        <span style="font-weight: 600;">เลือกทีมที่จะแสดง</span>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="selectAllTeams(true)" class="btn-mini">เลือกทั้งหมด</button>
                                            <button onclick="selectAllTeams(false)" class="btn-mini">ยกเลิกทั้งหมด</button>
                                        </div>
                                    </div>
                                    <div class="team-filter-grid">
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('A', this.checked)"><span class="team-badge team-badge-sm team-a">A</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('B', this.checked)"><span class="team-badge team-badge-sm team-b">B</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('C', this.checked)"><span class="team-badge team-badge-sm team-c">C</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('D', this.checked)"><span class="team-badge team-badge-sm team-d">D</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('E', this.checked)"><span class="team-badge team-badge-sm team-e">E</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('F', this.checked)"><span class="team-badge team-badge-sm team-f">F</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('G', this.checked)"><span class="team-badge team-badge-sm team-g">G</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('H', this.checked)"><span class="team-badge team-badge-sm team-h">H</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('I', this.checked)"><span class="team-badge team-badge-sm team-i">I</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('J', this.checked)"><span class="team-badge team-badge-sm team-j">J</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('K', this.checked)"><span class="team-badge team-badge-sm team-k">K</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('L', this.checked)"><span class="team-badge team-badge-sm team-l">L</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('M', this.checked)"><span class="team-badge team-badge-sm team-m">M</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('N', this.checked)"><span class="team-badge team-badge-sm team-n">N</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('O', this.checked)"><span class="team-badge team-badge-sm team-o">O</span></label>
                                        <label class="team-filter-item"><input type="checkbox" checked onchange="filterByTeam('Z', this.checked)"><span class="team-badge team-badge-sm team-z">Z</span></label>
                                    </div>
                                </div>
                            </div>
                            <!-- Export Dropdown -->
                            <div class="export-dropdown">
                                <button class="btn btn-outline" style="padding: 8px 14px;" onclick="toggleExportMenu('recent')">
                                    <i class="fas fa-download"></i> Export <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 4px;"></i>
                                </button>
                                <div class="export-menu" id="exportMenuRecent">
                                    <button class="export-menu-item excel" onclick="exportToExcel('recent-checkins')">
                                        <i class="fas fa-file-excel"></i> Export Excel
                                    </button>
                                    <button class="export-menu-item csv" onclick="exportToCSV('recent-checkins')">
                                        <i class="fas fa-file-csv"></i> Export CSV
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="checkins-list">
                        <div class="checkin-item" data-checkin-id="0">
                            <span class="team-badge team-badge-sm team-a">A</span>
                            <div class="checkin-avatar">อร</div>
                            <div class="checkin-info">
                                <div class="name">อรุณี วงศ์ประเสริฐ</div>
                                <div class="location"><i class="fas fa-location-dot"></i> Central World, กรุงเทพฯ</div>
                                <div class="time"><i class="far fa-clock"></i> 2 นาทีที่แล้ว <span class="actual-time">(10:01)</span></div>
                            </div>
                            <label class="toggle-switch" title="แสดงบนแผนที่">
                                <input type="checkbox" checked onchange="syncToggleMarker(0, this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="checkin-item" data-checkin-id="1">
                            <span class="team-badge team-badge-sm team-b">B</span>
                            <div class="checkin-avatar">สม</div>
                            <div class="checkin-info">
                                <div class="name">สมชาย ใจดี</div>
                                <div class="location"><i class="fas fa-location-dot"></i> Siam Paragon, กรุงเทพฯ</div>
                                <div class="time"><i class="far fa-clock"></i> 15 นาทีที่แล้ว <span class="actual-time">(09:48)</span></div>
                            </div>
                            <label class="toggle-switch" title="แสดงบนแผนที่">
                                <input type="checkbox" checked onchange="syncToggleMarker(1, this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="checkin-item" data-checkin-id="2">
                            <span class="team-badge team-badge-sm team-c">C</span>
                            <div class="checkin-avatar">วร</div>
                            <div class="checkin-info">
                                <div class="name">วรรณา สุขสันต์</div>
                                <div class="location"><i class="fas fa-location-dot"></i> EmQuartier, กรุงเทพฯ</div>
                                <div class="time"><i class="far fa-clock"></i> 32 นาทีที่แล้ว <span class="actual-time">(09:31)</span></div>
                            </div>
                            <label class="toggle-switch" title="แสดงบนแผนที่">
                                <input type="checkbox" checked onchange="syncToggleMarker(2, this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="checkin-item" data-checkin-id="3">
                            <span class="team-badge team-badge-sm team-d">D</span>
                            <div class="checkin-avatar">ปร</div>
                            <div class="checkin-info">
                                <div class="name">ประเสริฐ รุ่งเรือง</div>
                                <div class="location"><i class="fas fa-location-dot"></i> Terminal 21, กรุงเทพฯ</div>
                                <div class="time"><i class="far fa-clock"></i> 1 ชั่วโมงที่แล้ว <span class="actual-time">(09:03)</span></div>
                            </div>
                            <label class="toggle-switch" title="แสดงบนแผนที่">
                                <input type="checkbox" onchange="syncToggleMarker(3, this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="checkin-item" data-checkin-id="4">
                            <span class="team-badge team-badge-sm team-e">E</span>
                            <div class="checkin-avatar">มา</div>
                            <div class="checkin-info">
                                <div class="name">มานี มีศรี</div>
                                <div class="location"><i class="fas fa-location-dot"></i> ICONSIAM, กรุงเทพฯ</div>
                                <div class="time"><i class="far fa-clock"></i> 2 ชั่วโมงที่แล้ว <span class="actual-time">(08:05)</span></div>
                            </div>
                            <label class="toggle-switch" title="แสดงบนแผนที่">
                                <input type="checkbox" checked onchange="syncToggleMarker(4, this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full Data Table -->
            <div class="table-section">
                <div class="section-header">
                    <h2><i class="fas fa-table"></i> All Check-ins Data</h2>
                    <div class="header-actions-group">
                        <button class="btn btn-outline" onclick="toggleFilter()">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                        <div class="export-dropdown">
                            <button class="btn btn-primary" onclick="toggleExportMenu('full')">
                                <i class="fas fa-file-export"></i> Export <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 4px;"></i>
                            </button>
                            <div class="export-menu" id="exportMenuFull">
                                <button class="export-menu-item excel" onclick="exportToExcel('full-data')">
                                    <i class="fas fa-file-excel"></i> Export Excel (.xlsx)
                                </button>
                                <button class="export-menu-item csv" onclick="exportToCSV('full-data')">
                                    <i class="fas fa-file-csv"></i> Export CSV
                                </button>
                                <button class="export-menu-item pdf" onclick="exportToPDF()">
                                    <i class="fas fa-file-pdf"></i> Export PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ทีม</th>
                            <th>ลูกค้า</th>
                            <th>สถานที่</th>
                            <th>พิกัด</th>
                            <th>เวลา</th>
                            <th>สถานะ</th>
                            <th>แสดงบนแผนที่</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-checkin-id="0">
                            <td><span class="team-badge team-a">A</span></td>
                            <td><strong>อรุณี วงศ์ประเสริฐ</strong></td>
                            <td>Central World, กรุงเทพฯ</td>
                            <td><code>13.7466, 100.5392</code></td>
                            <td>22 ม.ค. 2026, 10:01</td>
                            <td><span class="checkin-status active">Active</span></td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked onchange="syncToggleMarker(0, this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                        </tr>
                        <tr data-checkin-id="1">
                            <td><span class="team-badge team-b">B</span></td>
                            <td><strong>สมชาย ใจดี</strong></td>
                            <td>Siam Paragon, กรุงเทพฯ</td>
                            <td><code>13.7460, 100.5347</code></td>
                            <td>22 ม.ค. 2026, 09:48</td>
                            <td><span class="checkin-status active">Active</span></td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked onchange="syncToggleMarker(1, this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                        </tr>
                        <tr data-checkin-id="2">
                            <td><span class="team-badge team-c">C</span></td>
                            <td><strong>วรรณา สุขสันต์</strong></td>
                            <td>EmQuartier, กรุงเทพฯ</td>
                            <td><code>13.7311, 100.5696</code></td>
                            <td>22 ม.ค. 2026, 09:31</td>
                            <td><span class="checkin-status active">Active</span></td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked onchange="syncToggleMarker(2, this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                        </tr>
                        <tr data-checkin-id="3">
                            <td><span class="team-badge team-d">D</span></td>
                            <td><strong>ประเสริฐ รุ่งเรือง</strong></td>
                            <td>Terminal 21, กรุงเทพฯ</td>
                            <td><code>13.7378, 100.5603</code></td>
                            <td>22 ม.ค. 2026, 09:03</td>
                            <td><span class="checkin-status pending">Pending</span></td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" onchange="syncToggleMarker(3, this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                        </tr>
                        <tr data-checkin-id="4">
                            <td><span class="team-badge team-e">E</span></td>
                            <td><strong>มานี มีศรี</strong></td>
                            <td>ICONSIAM, กรุงเทพฯ</td>
                            <td><code>13.7268, 100.5100</code></td>
                            <td>22 ม.ค. 2026, 08:05</td>
                            <td><span class="checkin-status active">Active</span></td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked onchange="syncToggleMarker(4, this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div><!-- End Dashboard Page -->

            <!-- Map View Page -->
            <div class="page-content" id="page-mapview" style="display: none;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-map-location-dot" style="color: var(--primary);"></i> Map View
                </h2>
                <div class="map-section" style="height: calc(100vh - 200px); position: relative;">
                    <div class="section-header">
                        <div class="header-actions-group">
                            <!-- Team Filter Dropdown with Checkboxes -->
                            <div class="team-filter-dropdown" id="mapViewTeamFilterDropdown">
                                <button class="btn btn-outline team-filter-btn" onclick="toggleMapViewTeamFilter()">
                                    <i class="fas fa-users"></i> ทีม <i class="fas fa-chevron-down" style="margin-left: 8px; font-size: 0.8rem;"></i>
                                </button>
                                <div class="team-filter-menu" id="mapViewTeamFilterMenu">
                                    <div class="team-filter-header">
                                        <span>เลือกทีมที่จะแสดง</span>
                                        <div>
                                            <button class="btn-link" onclick="mapViewSelectAllTeams()">เลือกทั้งหมด</button>
                                            <button class="btn-link" onclick="mapViewDeselectAllTeams()">ยกเลิกทั้งหมด</button>
                                        </div>
                                    </div>
                                    <div class="team-filter-grid">
                                        <label class="team-checkbox"><input type="checkbox" value="A" checked onchange="filterMapViewByTeam()"><span class="team-badge team-a">A</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="B" checked onchange="filterMapViewByTeam()"><span class="team-badge team-b">B</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="C" checked onchange="filterMapViewByTeam()"><span class="team-badge team-c">C</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="D" checked onchange="filterMapViewByTeam()"><span class="team-badge team-d">D</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="E" checked onchange="filterMapViewByTeam()"><span class="team-badge team-e">E</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="F" checked onchange="filterMapViewByTeam()"><span class="team-badge team-f">F</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="G" checked onchange="filterMapViewByTeam()"><span class="team-badge team-g">G</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="H" checked onchange="filterMapViewByTeam()"><span class="team-badge team-h">H</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="I" checked onchange="filterMapViewByTeam()"><span class="team-badge team-i">I</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="J" checked onchange="filterMapViewByTeam()"><span class="team-badge team-j">J</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="K" checked onchange="filterMapViewByTeam()"><span class="team-badge team-k">K</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="L" checked onchange="filterMapViewByTeam()"><span class="team-badge team-l">L</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="M" checked onchange="filterMapViewByTeam()"><span class="team-badge team-m">M</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="N" checked onchange="filterMapViewByTeam()"><span class="team-badge team-n">N</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="O" checked onchange="filterMapViewByTeam()"><span class="team-badge team-o">O</span></label>
                                        <label class="team-checkbox"><input type="checkbox" value="Z" checked onchange="filterMapViewByTeam()"><span class="team-badge team-z">Z</span></label>
                                    </div>
                                </div>
                            </div>
                            <select style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                                <option>วันนี้</option>
                                <option>เมื่อวาน</option>
                                <option>7 วันที่แล้ว</option>
                                <option>30 วันที่แล้ว</option>
                            </select>
                            <button class="btn btn-primary" onclick="filterMapView()"><i class="fas fa-search"></i> ค้นหา</button>
                        </div>
                        <div class="header-actions-group">
                             <button class="btn btn-measure" id="measureBtnFull" onclick="toggleMeasureFull()">
                                <i class="fas fa-ruler"></i> วัดระยะ
                            </button>
                        </div>
                    </div>
                    <!-- Full Screen Map Container -->
                    <div id="map-view" style="height: calc(100% - 81px); width: 100%; z-index: 1;"></div>
                    
                    <!-- Distance Panel for Map View -->
                    <div class="distance-panel" id="distancePanelFull">
                        <h4><i class="fas fa-ruler"></i> วัดระยะทาง</h4>
                        <div class="distance-info" id="distanceInfoFull">คลิกจุดแรกบนแผนที่...</div>
                        <div class="distance-value" id="distanceValueFull">-- <span>กม.</span></div>
                    </div>
                </div>
            </div>

            <!-- Check-ins List Page -->
            <div class="page-content" id="page-checkins" style="display: none;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-list-check" style="color: var(--primary);"></i> Check-ins List
                </h2>
                <div class="table-section">
                    <div class="section-header">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="ค้นหาลูกค้า, เลขสัญญา..." style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; width: 300px; font-family: 'Prompt', sans-serif;">
                            <select style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                                <option>ทุกทีม</option>
                                <option>Team A</option>
                                <option>Team B</option>
                            </select>
                            <select style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                                <option>ทุกสถานะ</option>
                                <option>Active</option>
                                <option>Pending</option>
                            </select>
                        </div>
                        <div class="header-actions-group">
                            <button class="btn btn-outline"><i class="fas fa-filter"></i> Filter</button>
                            <button class="btn btn-primary"><i class="fas fa-file-export"></i> Export</button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ทีม</th>
                                <th>ลูกค้า</th>
                                <th>เลขสัญญา</th>
                                <th>สาขา</th>
                                <th>เวลา</th>
                                <th>สถานะ</th>
                                <th>ภาพ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="team-badge team-a">A</span></td>
                                <td><strong>อรุณี วงศ์ประเสริฐ</strong></td>
                                <td><code>CT-12345</code></td>
                                <td>สาทร</td>
                                <td>22 ม.ค. 2026, 10:01</td>
                                <td><span class="checkin-status active">Active</span></td>
                                <td><i class="fas fa-image" style="color: var(--success);"></i></td>
                            </tr>
                            <tr>
                                <td><span class="team-badge team-b">B</span></td>
                                <td><strong>สมชาย ใจดี</strong></td>
                                <td><code>CT-67890</code></td>
                                <td>ปทุมวัน</td>
                                <td>22 ม.ค. 2026, 09:48</td>
                                <td><span class="checkin-status active">Active</span></td>
                                <td><i class="fas fa-image" style="color: var(--success);"></i></td>
                            </tr>
                            <tr>
                                <td><span class="team-badge team-c">C</span></td>
                                <td><strong>วรรณา สุขสันต์</strong></td>
                                <td><code>CT-11223</code></td>
                                <td>นนทบุรี</td>
                                <td>22 ม.ค. 2026, 09:31</td>
                                <td><span class="checkin-status active">Active</span></td>
                                <td><i class="fas fa-image" style="color: var(--success);"></i></td>
                            </tr>
                            <tr>
                                <td><span class="team-badge team-d">D</span></td>
                                <td><strong>ประเสริฐ รุ่งเรือง</strong></td>
                                <td><code>CT-44556</code></td>
                                <td>ลาดพร้าว</td>
                                <td>22 ม.ค. 2026, 09:03</td>
                                <td><span class="checkin-status pending">Pending</span></td>
                                <td><i class="fas fa-image" style="color: var(--warning);"></i></td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border);">
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">แสดง 1-4 จาก 127 รายการ</span>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-outline" style="padding: 8px 12px;"><i class="fas fa-chevron-left"></i></button>
                            <button class="btn btn-primary" style="padding: 8px 12px;">1</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">2</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">3</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Page -->
            <div class="page-content" id="page-customers" style="display: none;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-users" style="color: var(--primary);"></i> Customers
                </h2>
                <div class="stat-cards" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3>2,456</h3>
                            <p>ลูกค้าทั้งหมด</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-user-check"></i></div>
                        <div class="stat-info">
                            <h3>1,892</h3>
                            <p>ลูกค้า Active</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-user-plus"></i></div>
                        <div class="stat-info">
                            <h3>45</h3>
                            <p>ลูกค้าใหม่เดือนนี้</p>
                        </div>
                    </div>
                </div>
                <div class="table-section">
                    <div class="section-header">
                        <input type="text" placeholder="ค้นหาลูกค้า..." style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; width: 300px; font-family: 'Prompt', sans-serif;">
                        <button class="btn btn-primary"><i class="fas fa-plus"></i> เพิ่มลูกค้า</button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ลูกค้า</th>
                                <th>เลขสัญญา</th>
                                <th>สาขา</th>
                                <th>ติดตามล่าสุด</th>
                                <th>Check-ins</th>
                                <th>สถานะ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>อรุณี วงศ์ประเสริฐ</strong><br><small style="color: var(--text-secondary);">123/45 ซ.สุขุมวิท</small></td>
                                <td><code>CT-12345</code></td>
                                <td>สาทร</td>
                                <td>22 ม.ค. 2026</td>
                                <td>12</td>
                                <td><span class="checkin-status active">Active</span></td>
                            </tr>
                            <tr>
                                <td><strong>สมชาย ใจดี</strong><br><small style="color: var(--text-secondary);">789/12 ถ.พระราม 4</small></td>
                                <td><code>CT-67890</code></td>
                                <td>ปทุมวัน</td>
                                <td>21 ม.ค. 2026</td>
                                <td>8</td>
                                <td><span class="checkin-status active">Active</span></td>
                            </tr>
                            <tr>
                                <td><strong>วรรณา สุขสันต์</strong><br><small style="color: var(--text-secondary);">456 ถ.รัชดาภิเษก</small></td>
                                <td><code>CT-11223</code></td>
                                <td>นนทบุรี</td>
                                <td>20 ม.ค. 2026</td>
                                <td>15</td>
                                <td><span class="checkin-status active">Active</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Page -->
            <div class="page-content" id="page-reports" style="display: none;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-line" style="color: var(--primary);"></i> Reports
                </h2>
                <div class="stat-cards" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-calendar-check"></i></div>
                        <div class="stat-info">
                            <h3>3,456</h3>
                            <p>Check-ins เดือนนี้</p>
                            <div class="stat-trend up"><i class="fas fa-arrow-up"></i> +15%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-percentage"></i></div>
                        <div class="stat-info">
                            <h3>97.2%</h3>
                            <p>อัตราความสำเร็จ</p>
                            <div class="stat-trend up"><i class="fas fa-arrow-up"></i> +2.1%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <h3>45 นาที</h3>
                            <p>เวลาเฉลี่ยต่อสาย</p>
                            <div class="stat-trend down"><i class="fas fa-arrow-down"></i> -5 นาที</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="content-grid" style="grid-template-columns: 2fr 1fr; margin-bottom: 24px;">
                    <!-- Bar Chart - Check-ins per Day -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Check-ins รายวัน (7 วันล่าสุด)</h3>
                            <select style="padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; font-family: 'Prompt', sans-serif;">
                                <option>7 วัน</option>
                                <option>14 วัน</option>
                                <option>30 วัน</option>
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <div class="bar-chart" id="barChart">
                                <div class="bar-item">
                                    <div class="bar" style="height: 120px;"><span class="bar-value">98</span></div>
                                    <span class="bar-label">จ.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 150px; background: linear-gradient(to top, #10b981, #34d399);"><span class="bar-value">122</span></div>
                                    <span class="bar-label">อ.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 100px;"><span class="bar-value">82</span></div>
                                    <span class="bar-label">พ.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 170px; background: linear-gradient(to top, #10b981, #34d399);"><span class="bar-value">139</span></div>
                                    <span class="bar-label">พฤ.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 130px;"><span class="bar-value">106</span></div>
                                    <span class="bar-label">ศ.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 80px; background: linear-gradient(to top, #f59e0b, #fbbf24);"><span class="bar-value">65</span></div>
                                    <span class="bar-label">ส.</span>
                                </div>
                                <div class="bar-item">
                                    <div class="bar" style="height: 60px; background: linear-gradient(to top, #f59e0b, #fbbf24);"><span class="bar-value">49</span></div>
                                    <span class="bar-label">อา.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Donut Chart - Status Distribution -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> สถานะ Check-in</h3>
                        </div>
                        <div class="chart-wrapper" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div class="donut-chart" style="background: conic-gradient(#10b981 0deg 277deg, #f59e0b 277deg 324deg, #ef4444 324deg 360deg);">
                                <div class="donut-center">
                                    <span class="value">661</span>
                                    <span class="label">รายการ</span>
                                </div>
                            </div>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-dot" style="background: #10b981;"></span>
                                    <span>สำเร็จ (77%)</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-dot" style="background: #f59e0b;"></span>
                                    <span>รอดำเนินการ (13%)</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-dot" style="background: #ef4444;"></span>
                                    <span>ยกเลิก (10%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Performance Chart -->
                <div class="chart-container" style="margin-bottom: 24px;">
                    <div class="chart-header">
                        <h3><i class="fas fa-users"></i> Performance รายทีม</h3>
                        <div class="export-dropdown">
                            <button class="btn btn-outline" onclick="toggleExportMenu('team-perf')">
                                <i class="fas fa-download"></i> Export <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i>
                            </button>
                            <div class="export-menu" id="exportMenuTeam-perf">
                                <button class="export-menu-item excel" onclick="exportToExcel('team-performance')">
                                    <i class="fas fa-file-excel"></i> Export Excel
                                </button>
                                <button class="export-menu-item csv" onclick="exportToCSV('team-performance')">
                                    <i class="fas fa-file-csv"></i> Export CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 12px; padding: 20px 0;">
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 120px; background: linear-gradient(to top, #ef4444, #f87171); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">245</span>
                                </div>
                            </div>
                            <span class="team-badge team-a" style="margin-top: 10px;">A</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 110px; background: linear-gradient(to top, #10b981, #34d399); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">231</span>
                                </div>
                            </div>
                            <span class="team-badge team-b" style="margin-top: 10px;">B</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 100px; background: linear-gradient(to top, #f59e0b, #fbbf24); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">218</span>
                                </div>
                            </div>
                            <span class="team-badge team-c" style="margin-top: 10px;">C</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 90px; background: linear-gradient(to top, #0ea5e9, #38bdf8); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">205</span>
                                </div>
                            </div>
                            <span class="team-badge team-d" style="margin-top: 10px;">D</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 85px; background: linear-gradient(to top, #8b5cf6, #a78bfa); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">198</span>
                                </div>
                            </div>
                            <span class="team-badge team-e" style="margin-top: 10px;">E</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 75px; background: linear-gradient(to top, #ec4899, #f472b6); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">185</span>
                                </div>
                            </div>
                            <span class="team-badge team-f" style="margin-top: 10px;">F</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 65px; background: linear-gradient(to top, #06b6d4, #22d3ee); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">172</span>
                                </div>
                            </div>
                            <span class="team-badge team-g" style="margin-top: 10px;">G</span>
                        </div>
                        <div style="text-align: center;">
                            <div style="height: 140px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center;">
                                <div style="width: 50px; height: 55px; background: linear-gradient(to top, #84cc16, #a3e635); border-radius: 8px 8px 0 0; position: relative;">
                                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-weight: 600; font-size: 0.85rem;">156</span>
                                </div>
                            </div>
                            <span class="team-badge team-h" style="margin-top: 10px;">H</span>
                        </div>
                    </div>
                </div>

                <div class="content-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="table-section">
                        <div class="section-header"><h2><i class="fas fa-trophy"></i> Top Teams</h2></div>
                        <table class="data-table">
                            <thead><tr><th>ทีม</th><th>Check-ins</th><th>สำเร็จ</th></tr></thead>
                            <tbody>
                                <tr><td><span class="team-badge team-a">A</span></td><td>245</td><td>98.5%</td></tr>
                                <tr><td><span class="team-badge team-b">B</span></td><td>231</td><td>97.8%</td></tr>
                                <tr><td><span class="team-badge team-c">C</span></td><td>218</td><td>96.5%</td></tr>
                                <tr><td><span class="team-badge team-d">D</span></td><td>205</td><td>95.2%</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="table-section">
                        <div class="section-header"><h2><i class="fas fa-building"></i> Top Branches</h2></div>
                        <table class="data-table">
                            <thead><tr><th>สาขา</th><th>Check-ins</th><th>ลูกค้า</th></tr></thead>
                            <tbody>
                                <tr><td>สาทร</td><td>156</td><td>89</td></tr>
                                <tr><td>ปทุมวัน</td><td>142</td><td>76</td></tr>
                                <tr><td>นนทบุรี</td><td>128</td><td>65</td></tr>
                                <tr><td>ลาดพร้าว</td><td>115</td><td>58</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Photo Gallery Page -->
            <div class="page-content" id="page-gallery" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-images" style="color: var(--primary);"></i> Photo Gallery
                    </h2>
                    <div style="display: flex; gap: 12px;">
                        <select id="galleryTeamFilter" style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;" onchange="filterGallery()">
                            <option value="all">ทุกทีม</option>
                            <option value="A">Team A</option>
                            <option value="B">Team B</option>
                            <option value="C">Team C</option>
                            <option value="D">Team D</option>
                            <option value="E">Team E</option>
                        </select>
                        <select id="galleryTypeFilter" style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;" onchange="filterGallery()">
                            <option value="all">ทุกประเภท</option>
                            <option value="house">รูปหน้าบ้าน</option>
                            <option value="contract">รูปสัญญา</option>
                        </select>
                        <input type="date" id="galleryDateFilter" style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;" value="2026-01-25" onchange="filterGallery()">
                    </div>
                </div>

                <!-- Gallery Stats -->
                <div class="stat-cards" style="margin-bottom: 24px; grid-template-columns: repeat(3, 1fr);">
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-images"></i></div>
                        <div class="stat-info">
                            <h3 id="galleryTotalCount">254</h3>
                            <p>รูปภาพทั้งหมด</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-home"></i></div>
                        <div class="stat-info">
                            <h3>127</h3>
                            <p>รูปหน้าบ้าน</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-file-contract"></i></div>
                        <div class="stat-info">
                            <h3>127</h3>
                            <p>รูปสัญญา</p>
                        </div>
                    </div>
                </div>

                <!-- Gallery Grid -->
                <div class="table-section" style="padding: 24px;">
                    <div class="gallery-grid" id="galleryGrid">
                        <!-- Gallery Item 1 -->
                        <div class="gallery-item" onclick="openImageViewer(0)">
                            <img src="https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">อรุณี วงศ์ประเสริฐ</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-a" style="width: 18px; height: 18px; font-size: 0.6rem;">A</span> หน้าบ้าน • 10:01</div>
                            </div>
                        </div>
                        <!-- Gallery Item 2 -->
                        <div class="gallery-item" onclick="openImageViewer(1)">
                            <img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">สมชาย ใจดี</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-b" style="width: 18px; height: 18px; font-size: 0.6rem;">B</span> หน้าบ้าน • 09:48</div>
                            </div>
                        </div>
                        <!-- Gallery Item 3 -->
                        <div class="gallery-item" onclick="openImageViewer(2)">
                            <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">วรรณา สุขสันต์</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-c" style="width: 18px; height: 18px; font-size: 0.6rem;">C</span> หน้าบ้าน • 09:31</div>
                            </div>
                        </div>
                        <!-- Gallery Item 4 -->
                        <div class="gallery-item" onclick="openImageViewer(3)">
                            <img src="https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">ประเสริฐ รุ่งเรือง</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-d" style="width: 18px; height: 18px; font-size: 0.6rem;">D</span> หน้าบ้าน • 09:03</div>
                            </div>
                        </div>
                        <!-- Gallery Item 5 -->
                        <div class="gallery-item" onclick="openImageViewer(4)">
                            <img src="https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">มานี มีศรี</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-e" style="width: 18px; height: 18px; font-size: 0.6rem;">E</span> หน้าบ้าน • 08:05</div>
                            </div>
                        </div>
                        <!-- Gallery Item 6 -->
                        <div class="gallery-item" onclick="openImageViewer(5)">
                            <img src="https://images.unsplash.com/photo-1600573472550-8090b5e0745e?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">สุนทร โชคดี</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-a" style="width: 18px; height: 18px; font-size: 0.6rem;">A</span> หน้าบ้าน • 07:45</div>
                            </div>
                        </div>
                        <!-- Gallery Item 7 -->
                        <div class="gallery-item" onclick="openImageViewer(6)">
                            <img src="https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">พิมพ์ใจ รักดี</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-b" style="width: 18px; height: 18px; font-size: 0.6rem;">B</span> หน้าบ้าน • 07:30</div>
                            </div>
                        </div>
                        <!-- Gallery Item 8 -->
                        <div class="gallery-item" onclick="openImageViewer(7)">
                            <img src="https://images.unsplash.com/photo-1600585154526-990dced4db0d?w=400&h=300&fit=crop" alt="House Front">
                            <div class="gallery-info">
                                <div class="name">วิชัย ใจกว้าง</div>
                                <div class="meta"><span class="team-badge team-badge-sm team-c" style="width: 18px; height: 18px; font-size: 0.6rem;">C</span> หน้าบ้าน • 07:15</div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div style="padding: 20px 0; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border); margin-top: 24px;">
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">แสดง 1-8 จาก 254 รูปภาพ</span>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-outline" style="padding: 8px 12px;"><i class="fas fa-chevron-left"></i></button>
                            <button class="btn btn-primary" style="padding: 8px 12px;">1</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">2</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">3</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">...</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;">32</button>
                            <button class="btn btn-outline" style="padding: 8px 12px;"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page-content" id="page-settings" style="display: none;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-cog" style="color: var(--primary);"></i> Settings
                </h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="table-section" style="padding: 24px;">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-user-cog"></i> บัญชีผู้ใช้</h3>
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 6px;">ชื่อผู้ใช้</label>
                                <input type="text" value="John Smith" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 6px;">อีเมล</label>
                                <input type="email" value="john.smith@company.com" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 6px;">บทบาท</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif;">
                                    <option>Administrator</option>
                                    <option>Team Leader</option>
                                    <option>Staff</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" style="margin-top: 10px;"><i class="fas fa-save"></i> บันทึก</button>
                        </div>
                    </div>
                    <div class="table-section" style="padding: 24px;">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-bell"></i> การแจ้งเตือน</h3>
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>แจ้งเตือน Check-in ใหม่</span>
                                <label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>แจ้งเตือนทางอีเมล</span>
                                <label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>รายงานประจำวัน</span>
                                <label class="toggle-switch"><input type="checkbox"><span class="toggle-slider"></span></label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>แจ้งเตือนเมื่อมี Pending</span>
                                <label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Leaflet Map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // OpenStreetMap tiles (default)
        const osmTileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';

        // Initialize Map
        const map = L.map('map').setView([13.7400, 100.5400], 13);
        
        // Add tile layer (OpenStreetMap)
        L.tileLayer(osmTileUrl, {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Initialize Map View (Second Map)
        let mapView = null;
        let mapViewLayers = [];

        function initMapView() {
            if (!mapView) {
                mapView = L.map('map-view').setView([13.7400, 100.5400], 13);
                L.tileLayer(osmTileUrl, {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(mapView);
                
                // Add click handler for Map View distance measurement
                mapView.on('click', function(e) {
                    if (!measureModeFull) return;
                    
                    const pointNum = measurePointsFull.length + 1;
                    const pointIcon = L.divIcon({
                        className: 'measure-point',
                        html: `<div style="background: #ef4444; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: bold;">${pointNum}</div>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });
                    
                    const marker = L.marker(e.latlng, { icon: pointIcon }).addTo(mapView);
                    measureMarkersFull.push(marker);
                    measurePointsFull.push(e.latlng);
                    
                    updateMeasureLineFull();
                    
                    const distFull = calculateTotalDistanceFull();
                    if (measurePointsFull.length === 1) {
                         document.getElementById('distanceValueFull').innerHTML = '0.00 <span>กม.</span>';
                    } else {
                        if (distFull < 1) {
                            document.getElementById('distanceValueFull').innerHTML = `${(distFull * 1000).toFixed(0)} <span>เมตร</span>`;
                        } else {
                            document.getElementById('distanceValueFull').innerHTML = `${distFull.toFixed(2)} <span>กม.</span>`;
                        }
                    }
                });
            }
            // Update markers whenever map view is shown (use team filter version)
            updateMapViewMarkersWithTeamFilter();
        }

        // Custom marker icon generator
        function createCustomIcon(team) {
            // Define gradients based on team (16 teams: A-O, Z)
            const gradients = {
                'A': 'linear-gradient(135deg, #ef4444, #dc2626)', // Red
                'B': 'linear-gradient(135deg, #10b981, #059669)', // Green
                'C': 'linear-gradient(135deg, #f59e0b, #d97706)', // Orange
                'D': 'linear-gradient(135deg, #0ea5e9, #0284c7)', // Blue
                'E': 'linear-gradient(135deg, #8b5cf6, #7c3aed)', // Purple
                'F': 'linear-gradient(135deg, #ec4899, #db2777)', // Pink
                'G': 'linear-gradient(135deg, #14b8a6, #0d9488)', // Teal
                'H': 'linear-gradient(135deg, #f97316, #ea580c)', // Deep Orange
                'I': 'linear-gradient(135deg, #6366f1, #4f46e5)', // Indigo
                'J': 'linear-gradient(135deg, #84cc16, #65a30d)', // Lime
                'K': 'linear-gradient(135deg, #06b6d4, #0891b2)', // Cyan
                'L': 'linear-gradient(135deg, #a855f7, #9333ea)', // Violet
                'M': 'linear-gradient(135deg, #f43f5e, #e11d48)', // Rose
                'N': 'linear-gradient(135deg, #22c55e, #16a34a)', // Emerald
                'O': 'linear-gradient(135deg, #eab308, #ca8a04)', // Yellow
                'Z': 'linear-gradient(135deg, #64748b, #475569)'  // Slate (Special Team)
            };

            const gradient = gradients[team] || 'linear-gradient(135deg, #0ea5e9, #06b6d4)'; // Default Blue

            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: ${gradient}; width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.3);"></div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });
        }

        // Sample check-in locations
        const locations = [
            { lat: 13.7466, lng: 100.5392, name: 'อรุณี วงศ์ประเสริฐ', place: 'Central World', team: 'A' },
            { lat: 13.7460, lng: 100.5347, name: 'สมชาย ใจดี', place: 'Siam Paragon', team: 'B' },
            { lat: 13.7311, lng: 100.5696, name: 'วรรณา สุขสันต์', place: 'EmQuartier', team: 'C' },
            { lat: 13.7378, lng: 100.5603, name: 'ประเสริฐ รุ่งเรือง', place: 'Terminal 21', team: 'D' },
            { lat: 13.7268, lng: 100.5100, name: 'มานี มีศรี', place: 'ICONSIAM', team: 'E' }
        ];

        // Store markers
        const markers = [];

        // Add markers
        locations.forEach((loc, index) => {
            const marker = L.marker([loc.lat, loc.lng], { icon: createCustomIcon(loc.team) })
                .bindPopup(`
                    <div style="font-family: 'Prompt', sans-serif; padding: 5px;">
                        <strong style="font-size: 1rem;">${loc.name}</strong> <span style="font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; background: #f1f5f9; color: #64748b;">Team ${loc.team}</span><br>
                        <span style="color: #64748b;"><i class="fas fa-location-dot"></i> ${loc.place}</span>
                    </div>
                `)
                .addTo(map);
            markers.push(marker);
        });

        // Function to update markers on Map View based on filter
        function updateMapViewMarkers() {
            if (!mapView) return;

            // Clear existing layers
            mapViewLayers.forEach(layer => mapView.removeLayer(layer));
            mapViewLayers = [];
            
            const filterTeam = document.getElementById('mapViewTeamFilter').value;

            locations.forEach(loc => {
                // Check both dropdown filter and team visibility checkbox
                const teamVisible = teamVisibility[loc.team];
                const matchesDropdown = filterTeam === 'all' || loc.team === filterTeam;
                
                if (matchesDropdown && teamVisible) {
                    const marker = L.marker([loc.lat, loc.lng], { icon: createCustomIcon(loc.team) })
                        .bindPopup(`
                            <div style="font-family: 'Prompt', sans-serif; padding: 5px;">
                                <strong style="font-size: 1rem;">${loc.name}</strong> <span style="font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; background: #f1f5f9; color: #64748b;">Team ${loc.team}</span><br>
                                <span style="color: #64748b;"><i class="fas fa-location-dot"></i> ${loc.place}</span>
                            </div>
                        `)
                        .addTo(mapView);
                    mapViewLayers.push(marker);
                }
            });
        }
        
        // Filter function for Map View
        function filterMapView() {
             updateMapViewMarkers();
        }

        // Initially hide marker at index 3 (matching unchecked toggle)
        map.removeLayer(markers[3]);

        // Toggle marker visibility
        function toggleMarker(index, visible) {
            if (visible) {
                markers[index].addTo(map);
            } else {
                map.removeLayer(markers[index]);
            }
        }

        // Sync toggle between Recent Check-ins and All Check-ins Data table
        function syncToggleMarker(index, visible) {
            // Update map marker
            toggleMarker(index, visible);
            
            // Sync all checkboxes with the same checkin ID
            const allToggles = document.querySelectorAll(`[data-checkin-id="${index}"] input[type="checkbox"]`);
            allToggles.forEach(toggle => {
                toggle.checked = visible;
            });
        }

        // ===========================
        // Team Filter for Map
        // ===========================
        let teamVisibility = {
            'A': true, 'B': true, 'C': true, 'D': true, 'E': true,
            'F': true, 'G': true, 'H': true, 'I': true, 'J': true,
            'K': true, 'L': true, 'M': true, 'N': true, 'O': true, 'Z': true
        };

        function toggleTeamFilterMenu() {
            const menu = document.getElementById('teamFilterMenu');
            menu.classList.toggle('active');
            // Close Map View team filter if open
            const mapViewMenu = document.getElementById('mapViewTeamFilterMenu');
            if (mapViewMenu) mapViewMenu.classList.remove('active');
        }

        // Map View Team Filter Functions
        let mapViewTeamVisibility = {
            'A': true, 'B': true, 'C': true, 'D': true, 'E': true,
            'F': true, 'G': true, 'H': true, 'I': true, 'J': true,
            'K': true, 'L': true, 'M': true, 'N': true, 'O': true, 'Z': true
        };

        function toggleMapViewTeamFilter() {
            const menu = document.getElementById('mapViewTeamFilterMenu');
            menu.classList.toggle('active');
            // Close dashboard team filter if open
            const dashboardMenu = document.getElementById('teamFilterMenu');
            if (dashboardMenu) dashboardMenu.classList.remove('active');
        }

        function filterMapViewByTeam() {
            const checkboxes = document.querySelectorAll('#mapViewTeamFilterMenu .team-checkbox input');
            checkboxes.forEach(cb => {
                mapViewTeamVisibility[cb.value] = cb.checked;
            });
            updateMapViewMarkersWithTeamFilter();
        }

        function mapViewSelectAllTeams() {
            const checkboxes = document.querySelectorAll('#mapViewTeamFilterMenu .team-checkbox input');
            checkboxes.forEach(cb => {
                cb.checked = true;
                mapViewTeamVisibility[cb.value] = true;
            });
            updateMapViewMarkersWithTeamFilter();
        }

        function mapViewDeselectAllTeams() {
            const checkboxes = document.querySelectorAll('#mapViewTeamFilterMenu .team-checkbox input');
            checkboxes.forEach(cb => {
                cb.checked = false;
                mapViewTeamVisibility[cb.value] = false;
            });
            updateMapViewMarkersWithTeamFilter();
        }

        function updateMapViewMarkersWithTeamFilter() {
            if (!mapView) return;
            
            // Clear existing layers
            mapViewLayers.forEach(layer => mapView.removeLayer(layer));
            mapViewLayers = [];
            
            // Re-add markers based on team visibility (ใช้ icon เหมือน Dashboard)
            locations.forEach(loc => {
                if (mapViewTeamVisibility[loc.team]) {
                    const marker = L.marker([loc.lat, loc.lng], { icon: createCustomIcon(loc.team) })
                        .bindPopup(`
                            <div style="font-family: 'Prompt', sans-serif; padding: 5px;">
                                <strong style="font-size: 1rem;">${loc.name}</strong> 
                                <span style="font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; background: #f1f5f9; color: #64748b;">Team ${loc.team}</span><br>
                                <span style="color: #64748b;"><i class="fas fa-location-dot"></i> ${loc.place}</span>
                            </div>
                        `)
                        .addTo(mapView);
                    mapViewLayers.push(marker);
                }
            });
        }

        function filterByTeam(team, visible) {
            teamVisibility[team] = visible;
            updateMarkersVisibility();
            updateCheckinListVisibility();
        }

        function selectAllTeams(selectAll) {
            const checkboxes = document.querySelectorAll('.team-filter-grid input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = selectAll;
            });
            
            // Update teamVisibility object
            Object.keys(teamVisibility).forEach(team => {
                teamVisibility[team] = selectAll;
            });
            
            updateMarkersVisibility();
            updateCheckinListVisibility();
        }

        function updateMarkersVisibility() {
            // Update markers on main map
            locations.forEach((loc, index) => {
                if (teamVisibility[loc.team]) {
                    // Check if individual toggle is on
                    const toggles = document.querySelectorAll('.checkins-list .toggle-switch input');
                    if (toggles[index] && toggles[index].checked) {
                        markers[index].addTo(map);
                    }
                } else {
                    map.removeLayer(markers[index]);
                }
            });

            // Update markers on Map View if it exists
            if (mapView) {
                updateMapViewMarkers();
            }
        }

        function updateCheckinListVisibility() {
            // Show/hide checkin items based on team filter
            const checkinItems = document.querySelectorAll('.checkins-list .checkin-item');
            checkinItems.forEach(item => {
                const teamBadge = item.querySelector('.team-badge');
                if (teamBadge) {
                    const team = teamBadge.textContent.trim();
                    if (teamVisibility[team]) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        }

        // Close team filter menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.team-filter-dropdown')) {
                const menu = document.getElementById('teamFilterMenu');
                if (menu) menu.classList.remove('active');
                const mapViewMenu = document.getElementById('mapViewTeamFilterMenu');
                if (mapViewMenu) mapViewMenu.classList.remove('active');
            }
        });

        // Filter Panel Toggle
        function toggleFilter() {
            const panel = document.getElementById('filterPanel');
            panel.classList.toggle('active');
        }

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show selected page
            const selectedPage = document.getElementById('page-' + pageName);
            if (selectedPage) {
                selectedPage.style.display = 'block';
                // Initialize map if switching to mapview
                if (pageName === 'mapview') {
                    setTimeout(() => {
                        initMapView();
                        mapView.invalidateSize();
                    }, 100);
                } else if (pageName === 'dashboard') {
                    setTimeout(() => {
                        map.invalidateSize();
                    }, 100);
                }
            }
            
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageName) {
                    item.classList.add('active');
                }
            });
        }

        // Apply Filters (mockup - just shows alert)
        function applyFilters() {
            const team = document.getElementById('filterTeam').value;
            const zone = document.getElementById('filterZone').value;
            const branch = document.getElementById('filterBranch').value;
            const date = document.getElementById('filterDate').value;
            
            alert(`กำลังกรองข้อมูล:\n- ทีม: ${team}\n- เขต: ${zone}\n- สาขา: ${branch}\n- วันที่: ${date}`);
        }

        // Distance Measurement - Multi-point like Google Maps
        let measureMode = false;
        let measurePoints = [];
        let measureMarkers = [];
        let measureLine = null;
        let totalDistance = 0;

        function toggleMeasure() {
            measureMode = !measureMode;
            const btn = document.getElementById('measureBtn');
            const panel = document.getElementById('distancePanel');
            
            if (measureMode) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-times"></i> ยกเลิก';
                panel.classList.add('active');
                document.getElementById('distanceInfo').innerHTML = 'คลิกเพื่อเพิ่มจุด <button onclick="clearMeasurement()" style="background: #ef4444; color: white; border: none; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; margin-left: 8px;"><i class="fas fa-trash"></i> ล้าง</button>';
                document.getElementById('distanceValue').innerHTML = '0.00 <span>กม.</span>';
                totalDistance = 0;
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-ruler"></i> วัดระยะ';
                panel.classList.remove('active');
                clearMeasurement();
            }
        }

        function clearMeasurement() {
            measurePoints = [];
            measureMarkers.forEach(m => map.removeLayer(m));
            measureMarkers = [];
            if (measureLine) {
                map.removeLayer(measureLine);
                measureLine = null;
            }
            totalDistance = 0;
            if (measureMode) {
                document.getElementById('distanceValue').innerHTML = '0.00 <span>กม.</span>';
            }
        }

        // Calculate distance using Haversine formula
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Calculate total distance for all points
        function calculateTotalDistance() {
            let total = 0;
            for (let i = 1; i < measurePoints.length; i++) {
                total += calculateDistance(
                    measurePoints[i-1].lat, measurePoints[i-1].lng,
                    measurePoints[i].lat, measurePoints[i].lng
                );
            }
            return total;
        }

        // Update the polyline with all points
        function updateMeasureLine() {
            if (measureLine) {
                map.removeLayer(measureLine);
            }
            if (measurePoints.length >= 2) {
                measureLine = L.polyline(measurePoints, {
                    color: '#ef4444',
                    weight: 3,
                    dashArray: '10, 10'
                }).addTo(map);
            }
        }

        // Map click handler for distance measurement
        map.on('click', function(e) {
            if (!measureMode) return;
            
            // Create marker with point number
            const pointNum = measurePoints.length + 1;
            const pointIcon = L.divIcon({
                className: 'measure-point',
                html: `<div style="background: #ef4444; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: bold;">${pointNum}</div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
            
            const marker = L.marker(e.latlng, { icon: pointIcon }).addTo(map);
            measureMarkers.push(marker);
            measurePoints.push(e.latlng);
            
            // Update the line
            updateMeasureLine();
            
            // Calculate and show total distance
            totalDistance = calculateTotalDistance();
            
            if (measurePoints.length === 1) {
                document.getElementById('distanceValue').innerHTML = '0.00 <span>กม.</span>';
            } else {
                // Show distance appropriately
                if (totalDistance < 1) {
                    // Show in meters if less than 1 km
                    document.getElementById('distanceValue').innerHTML = `${(totalDistance * 1000).toFixed(0)} <span>เมตร</span>`;
                } else {
                    document.getElementById('distanceValue').innerHTML = `${totalDistance.toFixed(2)} <span>กม.</span>`;
                }
            }
        });

        // -------------------------
        // Map View Measurement Tool
        // -------------------------
        let measureModeFull = false;
        let measurePointsFull = [];
        let measureMarkersFull = [];
        let measureLineFull = null;

        function toggleMeasureFull() {
            measureModeFull = !measureModeFull;
            const btn = document.getElementById('measureBtnFull');
            const panel = document.getElementById('distancePanelFull');
            
            if (measureModeFull) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-times"></i> ยกเลิก';
                panel.classList.add('active');
                document.getElementById('distanceInfoFull').innerHTML = 'คลิกเพื่อเพิ่มจุด <button onclick="clearMeasurementFull()" style="background: #ef4444; color: white; border: none; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; margin-left: 8px;"><i class="fas fa-trash"></i> ล้าง</button>';
                document.getElementById('distanceValueFull').innerHTML = '0.00 <span>กม.</span>';
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-ruler"></i> วัดระยะ';
                panel.classList.remove('active');
                clearMeasurementFull();
            }
        }

        function clearMeasurementFull() {
            measurePointsFull = [];
            measureMarkersFull.forEach(m => mapView.removeLayer(m));
            measureMarkersFull = [];
            if (measureLineFull) {
                mapView.removeLayer(measureLineFull);
                measureLineFull = null;
            }
            if (measureModeFull) {
                document.getElementById('distanceValueFull').innerHTML = '0.00 <span>กม.</span>';
            }
        }

        function calculateTotalDistanceFull() {
            let total = 0;
            for (let i = 1; i < measurePointsFull.length; i++) {
                total += calculateDistance(
                    measurePointsFull[i-1].lat, measurePointsFull[i-1].lng,
                    measurePointsFull[i].lat, measurePointsFull[i].lng
                );
            }
            return total;
        }

        function updateMeasureLineFull() {
            if (measureLineFull) {
                mapView.removeLayer(measureLineFull);
            }
            if (measurePointsFull.length >= 2) {
                measureLineFull = L.polyline(measurePointsFull, {
                    color: '#ef4444',
                    weight: 3,
                    dashArray: '10, 10'
                }).addTo(mapView);
            }
        }
    </script>
    <script>
        // Excel Export Functionality (dark mode removed)
        function exportToExcel(type) {
            // For real Excel export, we use SheetJS library approach
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOM for Thai support
            let filename = "export_data.csv";

            if (type === 'recent-checkins') {
                csvContent += "ทีม,ชื่อ,สถานที่,เวลา\n";
                const items = document.querySelectorAll('.checkins-list .checkin-item');
                items.forEach(item => {
                   const team = item.querySelector('.team-badge').innerText;
                   const name = item.querySelector('.name').innerText;
                   const loc = item.querySelector('.location').innerText.replace(',', ' ').replace(/\s+/g, ' ').trim();
                   const time = item.querySelector('.time').innerText.replace(/\s+/g, ' ').trim();
                   csvContent += `"${team}","${name}","${loc}","${time}"\n`;
                });
                filename = "recent_checkins_" + formatDateForFilename() + ".csv";
            } else if (type === 'full-data') {
                csvContent += "ทีม,ลูกค้า,สถานที่,พิกัด,เวลา,สถานะ\n";
                let targetRows = document.querySelectorAll('#page-dashboard .data-table tbody tr');
                if(document.getElementById('page-checkins').style.display !== 'none') {
                    targetRows = document.querySelectorAll('#page-checkins .data-table tbody tr');
                }

                targetRows.forEach(row => {
                    const cols = row.querySelectorAll('td');
                    const team = cols[0].innerText.trim();
                    const name = cols[1].innerText.replace('\n', ' ').trim();
                    const loc = cols[2].innerText.replace(',', ' ').trim();
                    const coord = cols[3] ? cols[3].innerText.trim() : '';
                    const time = cols[4] ? cols[4].innerText.trim() : '';
                    const status = cols[5] ? cols[5].innerText.trim() : '';
                    
                    csvContent += `"${team}","${name}","${loc}","${coord}","${time}","${status}"\n`;
                });
                filename = "checkin_data_" + formatDateForFilename() + ".csv";
            } else if (type === 'team-performance') {
                csvContent += "ทีม,จำนวน Check-ins,อัตราสำเร็จ\n";
                csvContent += '"A","245","98.5%"\n';
                csvContent += '"B","231","97.8%"\n';
                csvContent += '"C","218","96.5%"\n';
                csvContent += '"D","205","95.2%"\n';
                csvContent += '"E","198","94.8%"\n';
                csvContent += '"F","185","93.5%"\n';
                csvContent += '"G","172","92.1%"\n';
                csvContent += '"H","156","91.0%"\n';
                filename = "team_performance_" + formatDateForFilename() + ".csv";
            }

            downloadFile(csvContent, filename);
            showExportNotification('CSV', filename);
            closeAllExportMenus();
        }

        function exportToCSV(type) {
            exportToExcel(type); // Same as Excel for CSV
        }

        function exportToPDF() {
            // Mock PDF export - in real implementation, use jsPDF or similar
            alert('กำลังสร้างไฟล์ PDF...\n\nหมายเหตุ: ฟีเจอร์นี้ต้องเชื่อมต่อ Backend เพื่อสร้าง PDF จริง');
            closeAllExportMenus();
        }

        function downloadFile(content, filename) {
            const encodedUri = encodeURI(content);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function formatDateForFilename() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function showExportNotification(type, filename) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 24px;
                right: 24px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 10000;
                font-family: 'Prompt', sans-serif;
                display: flex;
                align-items: center;
                gap: 12px;
                animation: slideIn 0.3s ease;
            `;
            toast.innerHTML = `<i class="fas fa-check-circle"></i> ส่งออก ${type} สำเร็จ: ${filename}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Export Dropdown Toggle
        function toggleExportMenu(type) {
            closeAllExportMenus();
            const menu = document.getElementById('exportMenu' + type.charAt(0).toUpperCase() + type.slice(1));
            if (menu) {
                menu.classList.toggle('active');
            }
        }

        function closeAllExportMenus() {
            document.querySelectorAll('.export-menu').forEach(menu => {
                menu.classList.remove('active');
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.export-dropdown')) {
                closeAllExportMenus();
            }
        });

        // ===========================
        // Photo Gallery Functions
        // ===========================
        const galleryImages = [
            { src: 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800', name: 'อรุณี วงศ์ประเสริฐ', team: 'A', type: 'หน้าบ้าน', time: '10:01', contract: 'CT-12345' },
            { src: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800', name: 'สมชาย ใจดี', team: 'B', type: 'หน้าบ้าน', time: '09:48', contract: 'CT-67890' },
            { src: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800', name: 'วรรณา สุขสันต์', team: 'C', type: 'หน้าบ้าน', time: '09:31', contract: 'CT-11223' },
            { src: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800', name: 'ประเสริฐ รุ่งเรือง', team: 'D', type: 'หน้าบ้าน', time: '09:03', contract: 'CT-44556' },
            { src: 'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=800', name: 'มานี มีศรี', team: 'E', type: 'หน้าบ้าน', time: '08:05', contract: 'CT-77889' },
            { src: 'https://images.unsplash.com/photo-1600573472550-8090b5e0745e?w=800', name: 'สุนทร โชคดี', team: 'A', type: 'หน้าบ้าน', time: '07:45', contract: 'CT-99001' },
            { src: 'https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?w=800', name: 'พิมพ์ใจ รักดี', team: 'B', type: 'หน้าบ้าน', time: '07:30', contract: 'CT-22334' },
            { src: 'https://images.unsplash.com/photo-1600585154526-990dced4db0d?w=800', name: 'วิชัย ใจกว้าง', team: 'C', type: 'หน้าบ้าน', time: '07:15', contract: 'CT-55667' }
        ];

        let currentImageIndex = 0;

        function openImageViewer(index) {
            currentImageIndex = index;
            const img = galleryImages[index];
            
            // Create viewer if not exists
            let viewer = document.getElementById('imageViewer');
            if (!viewer) {
                viewer = document.createElement('div');
                viewer.id = 'imageViewer';
                viewer.className = 'image-viewer';
                viewer.innerHTML = `
                    <button class="viewer-close" onclick="closeImageViewer()"><i class="fas fa-times"></i></button>
                    <img id="viewerImage" src="" alt="">
                    <div class="viewer-info">
                        <h3 id="viewerName" style="margin-bottom: 8px;"></h3>
                        <p id="viewerMeta" style="opacity: 0.8;"></p>
                    </div>
                    <div style="position: absolute; bottom: 20px; display: flex; gap: 16px;">
                        <button onclick="prevImage()" class="btn btn-outline" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                            <i class="fas fa-chevron-left"></i> ก่อนหน้า
                        </button>
                        <button onclick="nextImage()" class="btn btn-outline" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                            ถัดไป <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                `;
                document.body.appendChild(viewer);
            }
            
            document.getElementById('viewerImage').src = img.src;
            document.getElementById('viewerName').textContent = img.name;
            document.getElementById('viewerMeta').innerHTML = `
                <span class="team-badge team-badge-sm team-${img.team.toLowerCase()}" style="width: 20px; height: 20px; font-size: 0.7rem;">${img.team}</span>
                ${img.type} • ${img.time} • สัญญา: ${img.contract}
            `;
            viewer.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeImageViewer() {
            const viewer = document.getElementById('imageViewer');
            if (viewer) {
                viewer.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
            openImageViewer(currentImageIndex);
        }

        function prevImage() {
            currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
            openImageViewer(currentImageIndex);
        }

        function filterGallery() {
            const team = document.getElementById('galleryTeamFilter').value;
            const type = document.getElementById('galleryTypeFilter').value;
            // In real implementation, this would filter and reload the gallery
            console.log('Filtering gallery:', { team, type });
        }

        // Keyboard navigation for image viewer
        document.addEventListener('keydown', function(e) {
            const viewer = document.getElementById('imageViewer');
            if (viewer && viewer.classList.contains('active')) {
                if (e.key === 'Escape') closeImageViewer();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
            }
        });

        // ===========================
        // Real-time Updates System
        // ===========================
        let realtimeInterval = null;
        let lastUpdateTime = new Date();

        function startRealtime() {
            if (realtimeInterval) return;
            
            realtimeInterval = setInterval(() => {
                simulateNewCheckin();
                updateRealtimeBadge();
            }, 30000); // Check every 30 seconds
            
            console.log('Real-time updates started');
        }

        function stopRealtime() {
            if (realtimeInterval) {
                clearInterval(realtimeInterval);
                realtimeInterval = null;
            }
        }

        function updateRealtimeBadge() {
            const badge = document.getElementById('realtimeBadge');
            if (badge) {
                const now = new Date();
                const diff = Math.floor((now - lastUpdateTime) / 1000);
                if (diff < 60) {
                    badge.innerHTML = '<span class="realtime-dot"></span><span>Live</span>';
                } else {
                    badge.innerHTML = `<span class="realtime-dot" style="background: #f59e0b;"></span><span>${Math.floor(diff/60)}m ago</span>`;
                }
            }
        }

        function simulateNewCheckin() {
            // Simulate receiving new check-in data
            const teams = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            const names = ['สมศักดิ์ รักงาน', 'อารยา ดีใจ', 'ประภาส สุขใส', 'วิไล งามเด่น'];
            const places = ['สยาม', 'อโศก', 'สีลม', 'พระราม 9', 'รัชดา'];
            
            const randomTeam = teams[Math.floor(Math.random() * teams.length)];
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomPlace = places[Math.floor(Math.random() * places.length)];
            
            // Update notification count
            const notifCount = document.getElementById('notificationCount');
            if (notifCount) {
                const current = parseInt(notifCount.textContent) || 0;
                notifCount.textContent = current + 1;
            }
            
            // Update stat card
            const statCards = document.querySelectorAll('.stat-card .stat-info h3');
            if (statCards[0]) {
                const current = parseInt(statCards[0].textContent) || 0;
                statCards[0].textContent = current + 1;
            }
            
            lastUpdateTime = new Date();
            
            // Show notification toast
            showNewCheckinNotification(randomTeam, randomName, randomPlace);
        }

        function showNewCheckinNotification(team, name, place) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 24px;
                background: white;
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.15);
                z-index: 10000;
                font-family: 'Prompt', sans-serif;
                display: flex;
                align-items: center;
                gap: 14px;
                border-left: 4px solid #0ea5e9;
                animation: slideInRight 0.3s ease;
                max-width: 350px;
            `;
            toast.innerHTML = `
                <span class="team-badge team-${team.toLowerCase()}" style="width: 36px; height: 36px;">${team}</span>
                <div>
                    <strong style="display: block; margin-bottom: 2px;">Check-in ใหม่!</strong>
                    <span style="color: #64748b; font-size: 0.9rem;">${name} - ${place}</span>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Global Search Handler
        function handleGlobalSearch(query) {
            if (query.length < 2) return;
            console.log('Searching for:', query);
            // In real implementation, this would filter data across all tables
        }

        // Start real-time on page load
        startRealtime();

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100px); opacity: 0; }
            }
            @keyframes slideInRight {
                from { transform: translateX(100px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
